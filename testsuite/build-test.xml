<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project [
   <!ENTITY libraries SYSTEM "../thirdparty/libraries.ent">
   <!ENTITY modules SYSTEM "../tools/etc/buildmagic/modules.ent">
]>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id$ -->


<project default="main" name="JBoss/EJB3 Tests"
   xmlns:server="http://jboss.org/ns/test/ant/server">
  
   <!-- ======================================================== -->
   <!-- Initialization                                           -->
   <!-- ======================================================== -->
   <tstamp>
      <format property="TIMENOW" pattern="yyyy-MM-dd.HH-mm" timezone="GMT"/>
   </tstamp>
   <echo message="${TIMENOW}" file="run.tstamp"/>
  
  <!-- Define test Classpath -->
  <path id="jboss.test.classpath">
    <pathelement path="${jboss.test.path}"/>
  </path>
  
   <property name="results_web" value="http://jboss.sourceforge.net/junit-results/32"/>
   <property name="buildlog.level" value="info" />
   <property environment="env"/>

   <!-- Set a hostname property based on COMPUTERNAME for win32, HOSTNAME
   otherwise and initialize the node0/node1 cluster hostnames to localhost
   and ${hostname} by default. If you cannot route multicast traffic between
   localhost and hostname, then you need to specify node0 and node1 binding
   in the local.properties that can in order to be able to run the clustering
   tests.
   -->
   <condition property="hostname" value="${env.COMPUTERNAME}">
      <os family="windows"/>
   </condition>
   <condition property="hostname" value="${env.HOSTNAME}">
      <not>
         <os family="windows"/>
      </not>
   </condition>

   <!--We will use local.properties file to provide some configuration
       to the testsuite mainly for the Clustering framework. Please
       do not checkin your local.properties file into CVS-->
   <property file="local.properties"/>

   <!-- Cluster node defaults -->
   <property name="node0" value="${env.MYTESTIP_1}" />
   <property name="node0.http.url" value="http://${node0}:8080" />
   <property name="node0.jndi.url" value="jnp://${node0}:1099" />
   <property name="node0.jndi.port1.url" value="jnp://${node0}:1199" />
   <property name="node0.http.port1.url" value="http://${node0}:8180" />
   <property name="node0.jgroups.bind_addr" value="${node0}" />
   <property name="node1" value="${env.MYTESTIP_2}" />
   <property name="node1.http.url" value="http://${node1}:8080" />
   <property name="node1.jndi.url" value="jnp://${node1}:1099" />
   <property name="node1.jgroups.bind_addr" value="${node1}" />

   <!-- UDP Group, must be done before server-config.xml -->
   <!-- The value of the -u option passed to jboss -->
   <!-- A blank value will prevent the -u option from being passed -->
   <!-- Override this in the local.properties or pass to Ant as -DupdGroup=128.x.x.x -->
   <property name="udpGroup" value=""/>
   <!-- Same thing, but passed to the client -->
   <property name="jbosstest.udpGroup" value="${udpGroup}"/>
  
  <!-- Set "jboss.dist" to JBOSS_HOME -->
  <property name="jboss.dist" value="${env.JBOSS_HOME}"/>
  
  <!-- Propagate the dist directory as a jbosstest system property -->
  <property name="jbosstest.dist" value="${jboss.dist}"/>
  
  <!-- Externalized locations -->
  <property name="location.resources.main" value="${basedir}/src/main/resources"/>
  <property name="location.resources.test" value="${basedir}/src/test/resources"/>
  <property name="location.target" value="${basedir}/target"/>
  <property name="location.artifact.tests" value="${location.target}/jboss-ejb3-testsuite-tests.jar" />
  <property name="location.dependencies" value="${location.target}/dependencies"/>
  <property name="location.dependencies.unpacked" value="${location.dependencies}/unpacked"/>
  <property name="location.dependencies.unpacked.jboss-test:jboss.test" value="${location.dependencies.unpacked}/jboss-test"/>
  <property name="location.dependencies.lib" value="${location.dependencies}/lib"/>
	<property name="location.dependencies.lib.ejb3persistence" value="${location.dependencies.lib}/ejb3-persistence.jar"/>
	<property name="location.dependencies.lib.jbosssx" value="${location.dependencies.lib}/jbosssx.jar"/>
  <property name="location.dependencies.lib.hibernate:hibernate3" value="${location.dependencies.lib}/hibernate.jar"/>
  <property name="location.dependencies.lib.jboss-test:jboss-test" value="${location.dependencies.lib}/jboss-test.jar"/>
  <property name="location.dependencies.lib.org.jboss.jbossas:server-manager" value="${location.dependencies.lib}/jboss-server-manager.jar"/>
  <property name="location.dependencies.lib.junit:junit" value="${location.dependencies.lib}/junit.jar"/>
  <property name="location.dependencies.lib.hsqldb:hsqldb" value="${location.dependencies.lib}/hsqldb.jar"/>
  <property name="location.dependencies.lib.apache-httpclient:commons-httpclient" value="${location.dependencies.lib}/commons-httpclient.jar"/>
  <property name="location.dependencies.lib.apache-codec:commons-codec" value="${location.dependencies.lib}/commons-codec.jar"/>
  <property name="location.dependencies.lib.org.jboss.cache:jbosscache-core" value="${location.dependencies.lib}/jbosscache-core.jar"/>
  <property name="location.dependencies.lib.org.jboss.jboss-deployers-core-spi" value="${location.dependencies.lib}/jboss-deployers-core-spi.jar"/>
  <property name="location.client.lib" value="${jboss.dist}/client"/>
  <property name="location.client.lib.commons-logging" value="${location.client.lib}/commons-logging.jar"/>
  <property name="location.client.lib.jbossall" value="${location.client.lib}/jbossall-client.jar"/>
  <property name="location.client.lib.jbossxb" value="${location.client.lib}/jboss-xml-binding.jar"/>
  <property name="location.client.lib.jbossws-spi" value="${location.client.lib}/jbossws-spi.jar"/>
  <property name="location.client.lib.jboss-metadata" value="${location.client.lib}/jboss-metadata.jar"/>
  <property name="location.client.lib.jboss-jaxws" value="${location.client.lib}/jboss-jaxws.jar"/>
  <property name="location.client.lib.jbossws-client" value="${location.client.lib}/jbossws-client.jar"/>
  <property name="location.client.lib.jboss-mdr" value="${location.client.lib}/jboss-mdr.jar"/>
  <property name="location.client.lib.apache.log4j" value="${location.client.lib}/log4j.jar"/>
    
  <!-- EJB3 Internal Artifacts -->
  <property name="artifact.ejb3.cache" value="${location.dependencies.lib}/jboss-ejb3-cache.jar"/>
  <property name="artifact.ejb3.interceptors" value="${location.dependencies.lib}/jboss-ejb3-interceptors.jar"/>
  <property name="artifact.ejb3.extapi" value="${location.dependencies.lib}/jboss-ejb3-ext-api.jar"/>
  <property name="artifact.ejb3.extapiimpl" value="${location.dependencies.lib}/jboss-ejb3-ext-api-impl.jar"/>
  <property name="artifact.ejb3.core" value="${location.dependencies.lib}/jboss-ejb3-core.jar"/>
	<property name="artifact.ejb3.pool" value="${location.dependencies.lib}/jboss-ejb3-pool.jar"/>
    
  <!-- Define the Path to Server Task Definitions, used by the JBoss Server Run targets -->
  <path id="server.taskdef.classpath">  
     <pathelement path="${location.dependencies.lib.jboss-test:jboss-test}"/>
     <pathelement path="${location.dependencies.lib.org.jboss.jbossas:server-manager}"/>
  </path>

  <!-- Import the jboss server run targets -->
  <import file="${location.dependencies.unpacked.jboss-test:jboss.test}/server-config.xml" /> 

  <!-- Define common JVM Arguments for all EJB3 JBossAS Runtimes -->
  <property name="ejb3.jboss.jvmargs" value="-Xmx512m -XX:MaxPermSize=256m -Dorg.jboss.resolver.warning=true -Djava.net.preferIPv4Stack=true -Dxb.builder.useUnorderedSequence=true"/>
  
  <!-- Extra options for ejbthree1504 -->
  <property name="ejbthree1504.jboss.jvmargs" value="${ejb3.jboss.jvmargs} -Dcom.sun.management.jmxremote"/>  
  
  <!-- Define JVM Arguments for specific EJB3 JBossAS Runtimes -->
  <property name="ssl-args" value="-Djavax.net.ssl.keyStore=${jboss.dist}/server/ejb3-ssl/conf/localhost.keystore -Djavax.net.ssl.keyStorePassword=opensource"/>
  
  <!-- 
  
  Define Server Configurations for EJB3 Integration Tests 
  
  -->
  <server:config javaHome="${env.JAVA_HOME}" jbossHome="${jboss.dist}" udpGroup="${udpGroup}">
     
    <!-- ejb3-ssl -->
    <server name="ejb3-ssl" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="${ssl-args}" />
    </server>
    
    <!-- ejb3-ssl-advanced -->
    <server name="ejb3-ssl-advanced" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server> 
    
    <!-- invoker -->
    <server name="invoker" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
    
    <!-- ejb3-jacc -->
    <server name="ejb3-jacc" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
    
    <!-- statelesscreation -->
    <server name="statelesscreation" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
    
    <!-- removedislocal -->
    <server name="removedislocal" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
    
    <!-- localfromremote1 -->
    <server name="localfromremote1" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
  
    <!-- localfromremote2 -->
    <server name="localfromremote2" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
    
    <!-- clusteredjms -->
    <server name="clusteredjms" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node1.jgroups.bind_addr}" />
    </server>
    
    <!-- clusteredjms2 -->
    <server name="clusteredjms2" host="${node1}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node0.jgroups.bind_addr}" />
    </server>
    
    <!-- libdeployment -->
    <server name="libdeployment" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
    
    <!-- statefulproxyfactoryoverride -->
    <server name="statefulproxyfactoryoverride" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>
    
    <!-- ejbthree1504 -->
    <server name="ejbthree1504" host="${node0}">
      <jvmarg value="${ejbthree1504.jboss.jvmargs}" />
    </server>  	    
    
    <!-- node0 -->
    <server name="node0" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node1.jgroups.bind_addr}" />
    </server>
    
    <!-- node1 -->
    <server name="node1" host="${node1}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node0.jgroups.bind_addr}" />
    </server>
  	
  	 <!-- clustered-ejb3-totalrep-0 -->
    <server name="clustered-ejb3-totalrep-0" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node0.jgroups.bind_addr}" />
      <jvmarg value="-Dsun.lang.ClassLoader.allowArraySyntax=true" />
      <jvmarg value="-Djava.endorsed.dirs=${jboss.dist}/lib/endorsed" />
      <jvmarg value="-Dresolve.dns=false" />
      <jvmarg value="-Djgroups.udp.ip_ttl=${jbosstest.udp.ip_ttl}" />
      <jvmarg value="-Djboss.messaging.ServerPeerID=0" />
    </server>
   
    <!-- clustered-ejb3-totalrep-1 -->
    <server name="clustered-ejb3-totalrep-1" host="${node1}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node1.jgroups.bind_addr}" />
      <jvmarg value="-Dsun.lang.ClassLoader.allowArraySyntax=true" />
      <jvmarg value="-Djava.endorsed.dirs=${jboss.dist}/lib/endorsed" />
      <jvmarg value="-Dresolve.dns=false" />
      <jvmarg value="-Djgroups.udp.ip_ttl=${jbosstest.udp.ip_ttl}" />
      <jvmarg value="-Djboss.messaging.ServerPeerID=1" />
   </server>
   
    <!-- clustered-ejb3-BR-0 -->
    <server name="clustered-ejb3-BR-0" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node0.jgroups.bind_addr}" />
      <jvmarg value="-Dsun.lang.ClassLoader.allowArraySyntax=true" />
      <jvmarg value="-Djava.endorsed.dirs=${jboss.dist}/lib/endorsed" />
      <jvmarg value="-Dresolve.dns=false" />
      <jvmarg value="-Djgroups.udp.ip_ttl=${jbosstest.udp.ip_ttl}" />
      <jvmarg value="-Djboss.messaging.ServerPeerID=0" />
    </server>
   
    <!-- clustered-ejb3-BR-1 -->
    <server name="clustered-ejb3-BR-1" host="${node1}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
      <jvmarg value="-Djgroups.bind_addr=${node1.jgroups.bind_addr}" />
      <jvmarg value="-Dsun.lang.ClassLoader.allowArraySyntax=true" />
      <jvmarg value="-Djava.endorsed.dirs=${jboss.dist}/lib/endorsed" />
      <jvmarg value="-Dresolve.dns=false" />
      <jvmarg value="-Djgroups.udp.ip_ttl=${jbosstest.udp.ip_ttl}" />
      <jvmarg value="-Djboss.messaging.ServerPeerID=1" />
   </server>
  	
    <!-- ejbthree1671 -->
    <server name="ejbthree1671" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>


    <!-- ejbthree1677 -->
    <server name="ejbthree1677" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>

  	<!-- ejbthree1629 -->
    <server name="ejbthree1629" host="${node0}">
      <jvmarg value="${ejb3.jboss.jvmargs}" />
    </server>


  </server:config>

   <!-- =================== -->
   <!-- Basic Configuration -->
   <!-- =================== -->

   <!-- Module name(s) & version -->
   <property name="module.name" value="ejb3"/>
   <property name="module.Name" value="JBoss Testsuite"/>
   <property name="module.version" value="DEV"/>
   <property name="module.source" value="${basedir}/src"/>
   <property name="module.output" value="${basedir}/target"/>


   <!-- ========= -->
   <!-- Libraries -->
   <!-- ========= -->
  
  <!--

  Classpath used by the Test Client

  -->
  <path id="client.classpath">

    <!-- JBoss Client Binaries -->
    <pathelement path="${location.client.lib.commons-logging}" />
    <pathelement path="${location.client.lib.jbossall}" />
    <pathelement path="${location.client.lib.jbossxb}" />
    <pathelement path="${location.client.lib.jbossws-spi}" />
    <pathelement path="${location.client.lib.jboss-metadata}" />
    <pathelement path="${location.client.lib.jboss-jaxws}" />
    
  </path>
  
  <!--
  
  Path to EJB3 Internals
  
  -->
  <path id="internals.path">
  
    <!-- EJB3 Cache -->
    <pathelement path="${artifact.ejb3.cache}" />
     
    <!-- EJB3 Core -->
    <pathelement path="${artifact.ejb3.core}" />
  	
  	<!-- EJB3 Interceptors -->
  	<pathelement path="${artifact.ejb3.interceptors}" />
	
	  <!-- EJB3 ExtApi -->
	  <pathelement path="${artifact.ejb3.extapi}" />
	
	  <!-- EJB3 ExtApiImpl -->
	  <pathelement path="${artifact.ejb3.extapiimpl}" />
  	
    <!-- EJB3 Pool -->
    <pathelement path="${artifact.ejb3.pool}" />
    
  </path>
    
  <!--
  
  Classpath used by Unit Tests
  
  -->
  <path id="test.classpath">
    
    <!-- Client -->
    <path refid="client.classpath" />
    
    <!-- EJB3 Internals -->
    <path refid="internals.path" />

    <!-- EJB3 TestSuite -->
    <pathelement path="${location.artifact.tests}" />

    <!-- JBoss Test Project -->
    <pathelement path="${location.dependencies.lib.jboss-test:jboss-test}" />
  	
    <!-- JBoss SX -->
    <pathelement path="${location.dependencies.lib.jbosssx}" />
  	
  	<!-- EJB3 Persistence -->
  	<pathelement path="${location.dependencies.lib.ejb3persistence}" />
	
	  <!-- Hibernate -->
	  <pathelement path="${location.dependencies.lib.hibernate:hibernate3}" />
    
    <!-- JBoss Deployers SPI -->
	  <pathelement path="${location.dependencies.lib.org.jboss.jboss-deployers-core-spi}" />
    
    <!-- JBoss Cache Core -->
    <pathelement path="${location.dependencies.lib.org.jboss.cache:jbosscache-core}" />

    <!-- JUnit -->
    <pathelement path="${location.dependencies.lib.junit:junit}" />

    <!-- HSQL DB -->
    <pathelement path="${location.dependencies.lib.hsqldb:hsqldb}" />
    
    <!-- Apache HttpClient -->
    <pathelement path="${location.dependencies.lib.apache-httpclient:commons-httpclient}" />
	
	  <!-- Apache Codec -->
    <pathelement path="${location.dependencies.lib.apache-codec:commons-codec}" />

    <!-- JBoss MDR -->
    <pathelement path="${location.client.lib.jboss-mdr}" />

    <!-- Root of jndi.properties -->
    <pathelement location="${resources}/test" />
    
    <!-- Resources required on the client CP -->
    <pathelement location="${location.target}/tests-classes/" />

    <!-- Client JARs not on jbossall-client (Hack; see EJBTHREE-1416) -->
    <pathelement location="${env.JBOSS_HOME}/lib/javassist.jar"/>
    <pathelement location="${env.JBOSS_HOME}/lib/jboss-aop.jar"/>
    <pathelement location="${env.JBOSS_HOME}/lib/trove.jar"/>
    <pathelement path="${location.client.lib.apache.log4j}" />
    
    <!-- webservice tests -->

    <pathelement location="${env.JBOSS_HOME}/client/jbossws-native-client.jar"/>
    <pathelement location="${env.JBOSS_HOME}/client/jbossws-native-jaxws.jar"/>
    <pathelement location="${env.JBOSS_HOME}/client/jaxb-api.jar"/>
    <pathelement location="${env.JBOSS_HOME}/lib/endorsed/xercesImpl.jar"/>
    <pathelement location="${env.JBOSS_HOME}/lib/endorsed/jboss-appclient.jar"/>


  </path>
  
  
  
   <!-- The combined library classpath -->
   <path id="library.classpath">
      <path refid="sun.jaf.classpath"/>
      <path refid="sun.servlet.classpath"/>
      <path refid="javassist.classpath"/>
      <path refid="qdox.classpath"/>
      <path refid="hibernate3.classpath"/>
      <path refid="ejb3-persistence.classpath"/>
      <path refid="dom4j.dom4j.classpath"/>
      <path refid="javassist.classpath"/>
      <path refid="trove.classpath"/>
      <path refid="xdoclet.xdoclet.classpath"/>
      <path refid="apache.ant.classpath"/>
      <path refid="oswego.concurrent.classpath"/>
      <path refid="junit.junit.classpath"/>
      <path refid="apache.log4j.classpath"/>
      <path refid="apache.xerces.classpath"/>
      <path refid="jboss.remoting.classpath"/>
      <path refid="jgroups.jgroups.classpath"/>
      <path refid="apache.httpclient.classpath"/>
      <path refid="apache.logging.classpath"/>
      <path refid="sun.javamail.classpath"/>
      <path refid="jboss.serialization.classpath"/>
      <path refid="jboss.jbossws.classpath"/>
      <path refid="jboss.jbossws.spi.classpath"/>
      <path refid="quartz.quartz.classpath"/>
      <path refid="jboss.microcontainer.classpath"/>
      <path refid="jboss.jbossxb.classpath"/>
      <path refid="hsqldb.hsqldb.classpath"/>
      <path refid="jboss.jboss.vfs.classpath"/>
      <path refid="jboss.integration.classpath"/>
      <path refid="jboss.jboss.ejb3.cache.classpath"/>
      <path refid="jboss.jboss.ejb3.ext.api.classpath"/>
      <path refid="jboss.jboss.ejb3.impl.classpath"/>
      <path refid="jboss.metadata.classpath"/>
      <path refid="jboss.jboss.ha.client.classpath"/>
      <path refid="jboss.jboss.ha.server.api.classpath"/>
      <path refid="jboss.cache.jbosscache.core.classpath"/>
      <path refid="sun.jaxb.classpath"/>
   </path>

   <!-- ======= -->
   <!-- Modules -->
   <!-- ======= -->

   <!-- ======= -->
   <!-- Modules -->
   <!-- ======= -->
   <!-- InternalServer -->
   <!-- This could be a mistake.  Perhaps, though, it would be a good idea to separate
   tests that need internal jboss classes from those that don't.  When I put it in, only
   the jca XATxConnectionManagerUnitTestCase needed an internal class (the tx manager)-->
   <property name="jboss.internal-server.root" value="${project.root}/server/output"/>
   <property name="jboss.internal-server.lib" value="${jboss.internal-server.root}/lib"/>
   <path id="jboss.internal-server.classpath">
      <pathelement path="${jboss.server.lib}/jboss.jar"/>
      <pathelement path="${jboss.server.lib}/jboss-system.jar"/>
   </path>

   <!-- The combined dependent module classpath -->
   <path id="dependentmodule.classpath">
      <path refid="jboss.jboss.javaee.classpath"/>
      <path refid="jboss.j2se.classpath"/>
      <path refid="jboss.aop.classpath"/>
      <path refid="jboss.aspects.classpath"/>
      <path refid="jboss.common.core.classpath"/>
      <path refid="jboss.common.logging.spi.classpath"/>
      <path refid="jboss.common.logging.log4j.classpath"/>
      <path refid="jboss.common.logging.jdk.classpath"/>
      <path refid="jboss.cache.jbosscache.core.classpath"/>
      <path refid="jboss.cluster.classpath"/>
      <path refid="jboss.main.classpath"/>
      <path refid="jboss.system.classpath"/>
      <path refid="jboss.systemjmx.classpath"/>
      <path refid="jboss.naming.classpath"/>
      <path refid="jboss.security.int.classpath"/>
      <path refid="jboss.jbosssx.classpath"/>
	  <path refid="jboss.jboss.security.spi.classpath"/>
      <!-- this is for the NonSerializableFactory -->
      <path refid="jboss.server.classpath"/>
      <path refid="jboss.mq.classpath"/>
      <path refid="jboss.test.classpath"/>
      <path refid="jboss.ejb3.classpath"/>
      <path refid="jboss.embedded.classpath"/>
      <!--path refid="jboss.webservice.classpath"/-->
	  <path refid="jboss.jca.classpath"/>
   </path>

   <!-- RMI Stub generation -->

   <!-- ===== -->
   <!-- Tasks -->
   <!-- ===== -->

   <!-- Where source files live -->
   <property name="source.java" value="${module.source}/test/java"/>
   <property name="source.etc" value="${module.source}/etc"/>
   <property name="resources" value="${location.resources.test}"/>
   <property name="source.stylesheets" value="${location.dependencies.unpacked.jboss-test:jboss.test}/stylesheets"/>

   <!-- Where build generated files will go -->
   <property name="build.reports" value="${module.output}/reports"/>
   <property name="build.testlog" value="${module.output}/log"/>
   <property name="build.classes" value="${module.output}/tests-classes"/>
   <property name="build.lib" value="${module.output}/test-lib"/>
   <property name="build.ejb3.lib" value="${module.output}/lib"/>
   <property name="build.api" value="${module.output}/api"/>
   <property name="build.etc" value="${module.output}/etc"/>
   <property name="build.stylesheets" value="${location.dependencies.unpacked.jboss-test:jboss.test}/stylesheets"/>
   <!-- build.resources is needed for the test-configs directory used by the create-config macro -->
   <property name="build.resources" value="${module.source}/test/resources"/>

   <!-- Install/Release structure -->
   <property name="install.id" value="${module.name}-${module.version}"/>
   <property name="release.id" value="${install.id}"/>
   <property name="install.root" value="${module.output}/${install.id}"/>

   <!-- The combined thirdparty classpath -->
   <path id="thirdparty.classpath">
      <path refid="library.classpath"/>
      <path refid="dependentmodule.classpath"/>
   </path>

   <!-- This module is based on Java 1.2 -->
   <property name="javac.target" value="1.2"/>

   <!-- classpath and local.classpath must have a value using with a path -->
   <property name="classpath" value=""/>
   <property name="local.classpath" value=""/>

   <!-- The classpath required to build classes. -->
   <path id="javac.classpath">
      <pathelement path="${classpath}"/>
      <!--pathelement path="${resources}/test/seam/jboss-seam.jar"/-->
      <pathelement path="${local.classpath}"/>
      <path refid="thirdparty.classpath"/>
   </path>

     <!--<path id="client.classpath">
      <pathelement path="${jboss.dist}/client/jbossall-client.jar"/>
      
       FIXME - shouldn't these be in jbossall-client.jar????
      <path refid="apache.codec.classpath"/>
      <path refid="apache.log4j.classpath"/>
      <path refid="apache.logging.classpath"/>
      <path refid="jboss.test.classpath"/>
      <path refid="sun.servlet.classpath"/>
      <pathelement path="${jboss.dist}/client/jboss-ejb3-client.jar"/>
	  <pathelement path="${jboss.dist}/lib/jboss-vfs.jar"/>
      <path refid="jboss.microcontainer.classpath"/>
      <path refid="jboss.metadata.classpath"/>

      - FIXME For cache passivation test -
      <path refid="jboss.cache.classpath"/>
      <path refid="jboss.cluster.classpath"/>
   </path> -->

   <!-- The "security" test needs JaasSecurityManagerServiceMBean -->
   <path id="security.client.classpath">
      <path refid="client.classpath"/>
      <path refid="jboss.jbosssx.classpath"/>
      <path refid="jboss.security.int.classpath"/>
	  <path refid="jboss.jboss.security.spi.classpath"/>
      <path refid="jboss.j2se.classpath"/>
   </path>

   <path id="dd.classpath">
      <path refid="client.classpath"/>
      <!-- This test accesses some ejb3 classes directly -->
      <path refid="jboss.ejb3.classpath"/>
   </path>

   <path id="dd.web.client.classpath">
      <path refid="client.classpath"/>
      <path refid="apache.httpclient.classpath"/>
   </path>

   <path id="full.classpath">
      <path refid="client.classpath"/>
      <!-- This test accesses some ejb3 classes directly -->
      <path refid="jboss.ejb3.classpath"/>
      <path refid="jboss.main.classpath"/>
      <path refid="jboss.systemjmx.classpath"/>
      <path refid="library.classpath"/>
   </path>

   <path id="iiop.client.classpath">
      <pathelement path="${resources}/test/iiop"/>
      <path refid="client.classpath"/>
   </path>

   <!-- The classpath required to build javadocs. -->
   <path id="javadoc.classpath">
      <path refid="javac.classpath"/>
   </path>

   <!-- Packages to include when generating api documentation -->
   <property name="javadoc.packages" value="javax.*"/>

   <!-- Override JUnit defaults -->
   <property name="jbosstest.iterationcount" value="10"/>
   <property name="jbosstest.threadcount" value="5"/>
   <property name="jbosstest.beancount" value="5"/>
   <property name="jbosstest.nodeploy" value="false"/>

   <import file="imports/build-simple.xml"/>

   <target name="init">
      <record name="${basedir}/build.log" append="yes" action="start" loglevel="error"/>
      <!-- Setup the version 1 classes so the tests compile -->
   </target>

   <target name="compile-stylesheets">
      <mkdir dir="${build.stylesheets}"/>
      <copy todir="${build.stylesheets}" filtering="yes">
         <fileset dir="${source.stylesheets}">
            <include name="**/*"/>
         </fileset>
      </copy>
   </target>
   <!-- ================================================================== -->
   <!-- Archives                                                           -->
   <!-- ================================================================== -->

   <target name="initial"
      description="Builds all jar files.">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/initial-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/initial/Test.class"/>
            <include name="org/jboss/ejb3/test/initial/TestLocal.class"/>
            <include name="org/jboss/ejb3/test/initial/TestRemote.class"/>
            <include name="org/jboss/ejb3/test/initial/TestBean.class"/>
            <include name="org/jboss/ejb3/test/initial/StatefulTest.class"/>
            <include name="org/jboss/ejb3/test/initial/StatefulTestBean.class"/>
            <include name="org/jboss/ejb3/test/initial/StatefulTestLocal.class"/>
            <include name="org/jboss/ejb3/test/initial/StatefulTestRemote.class"/>
            <include name="org/jboss/ejb3/test/initial/SecuredTest.class"/>
            <include name="org/jboss/ejb3/test/initial/SecuredTestRemote.class"/>
            <include name="org/jboss/ejb3/test/initial/SecuredTestLocal.class"/>
            <include name="org/jboss/ejb3/test/initial/SecuredTestBean.class"/>

            <include name="org/jboss/ejb3/test/initial/FirstInterceptor.class"/>
            <include name="org/jboss/ejb3/test/initial/InterceptedSFTest.class"/>
            <include name="org/jboss/ejb3/test/initial/InterceptedSFTestBean.class"/>
            <include name="org/jboss/ejb3/test/initial/InterceptedSLTest.class"/>
            <include name="org/jboss/ejb3/test/initial/InterceptedSLTestBean.class"/>
            <include name="org/jboss/ejb3/test/initial/SecondInterceptor.class"/>
            <include name="org/jboss/ejb3/test/initial/TestStatus.class"/>
            <include name="org/jboss/ejb3/test/initial/TestStatusBean.class"/>
            <include name="org/jboss/ejb3/test/initial/ExternalCallbackListener.class"/>
            <include name="org/jboss/ejb3/test/initial/ClassInjected.class"/>
            <include name="org/jboss/ejb3/test/initial/ClassInjectedBean.class"/>
         </fileset>
         <fileset dir="${resources}/test/initial">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>


      <jar jarfile="${build.lib}/initial-ejb3-test.sar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/initial/Tester*.class"/>
            <include name="org/jboss/ejb3/test/initial/TxTester*.class"/>
            <include name="org/jboss/ejb3/test/initial/SecurityTester*.class"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="META-INF/jboss-service.xml"/>
         </fileset>
         <fileset dir="${build.lib}">
            <include name="initial-test.jar"/>
         </fileset>
      </jar>
   </target>

   <target name="jca/inflowmdb">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/quartzmdb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jca/inflowmdb/Quartz*.class"/>
            <include name="org/jboss/ejb3/test/jca/inflowmdb/unit/*.class"/>
            <include name="org/jboss/ejb3/test/jca/inflowmdb/TestInterceptor.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/jcainflowmdb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jca/inflowmdb/Test*.class"/>
            <include name="org/jboss/ejb3/test/jca/inflowmdb/unit/*.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/jmsinflowmdb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jca/inflowmdb/JMS*.class"/>
            <include name="org/jboss/ejb3/test/jca/inflowmdb/Stateless*.class"/>
            <include name="org/jboss/ejb3/test/jca/inflowmdb/unit/*.class"/>
         </fileset>
         <fileset dir="${build.resources}/test/jca/inflow">
            <include name="jmsmdbtest-service.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/jcainflowmdb_dd.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jca/inflowmdb/DeploymentDescriptorTest*.class"/>
         </fileset>
         <fileset dir="${resources}/test/jca/inflow">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/jcainflow.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jca/inflow/*.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/jcainflow.rar">
         <fileset dir="${build.lib}">
            <include name="jcainflow.jar"/>
         </fileset>
         <fileset dir="${resources}/test/jca/inflow">
            <include name="META-INF/ra.xml"/>
         </fileset>
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/jca/inflow">
            <include name="*.xml"/>
         </fileset>
      </copy>

      <copy todir="${build.ejb3.lib}/embeddable/lib">
         <fileset dir="${build.lib}">
            <include name="jcainflow.jar"/>
            <include name="jcainflow.rar"/>
         </fileset>
      </copy>
   </target>

   <target name="cache">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/cache-test.sar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/cache/Tester*.class"/>
         </fileset>
         <fileset dir="${resources}/test/cache">
            <include name="META-INF/jboss-service.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/cache-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/cache/**/*.class"/>
            <exclude name="org/jboss/ejb3/test/cache/unit/*"/>
         </fileset>
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/cache">
            <include name="*.xml"/>
         </fileset>
      </copy>


   </target>

   <target name="factory">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/session1.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/factory/*1*.class"/>
         </fileset>
         <fileset dir="${resources}/test/factory/session1">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/session2.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/factory/*2*.class"/>
            <include name="org/jboss/ejb3/test/factory/MyService*.class"/>
         </fileset>
         <fileset dir="${resources}/test/factory/session2">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/util.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/factory/Util.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/factory-test.ear">
         <fileset dir="${build.lib}">
            <include name="session1.jar"/>
            <include name="session2.jar"/>
            <include name="util.jar"/>
         </fileset>
         <fileset dir="${resources}/test/factory">
            <include name="META-INF/application.xml"/>
            <include name="META-INF/jboss-app.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/session1xml.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/factoryxml/*1*.class"/>
         </fileset>
         <fileset dir="${resources}/test/factoryxml/session1">
            <include name="META-INF/persistence.xml"/>
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/session2xml.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/factoryxml/*2*.class"/>
            <include name="org/jboss/ejb3/test/factoryxml/MyService*.class"/>
         </fileset>
         <fileset dir="${resources}/test/factoryxml/session2">
            <include name="META-INF/persistence.xml"/>
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/utilxml.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/factoryxml/Util.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/factoryxml-test.ear">
         <fileset dir="${build.lib}">
            <include name="session1xml.jar"/>
            <include name="session2xml.jar"/>
            <include name="utilxml.jar"/>
         </fileset>
         <fileset dir="${resources}/test/factoryxml">
            <include name="META-INF/application.xml"/>
            <include name="META-INF/jboss-app.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="ear">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ear-session.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ear/Facade*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ear/ejbref">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/earpu.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ear/LibEntity.class"/>
         </fileset>
         <fileset dir="${resources}/test/ear/earlib">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/ref.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ear/ReferencedEntity.class"/>
         </fileset>
      </jar>
      <zip zipfile="${build.lib}/ear-test.ear">
         <zipfileset dir="${build.lib}">
            <include name="ear-session.jar"/>
         </zipfileset>
         <zipfileset dir="${build.lib}" prefix="lib">
            <include name="ref.jar"/>
            <include name="earpu.jar"/>
         </zipfileset>
      </zip>

   </target>

   <target name="dependency">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbjar.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dependency/Has*.class"/>
            <include name="org/jboss/ejb3/test/dependency/No*.class"/>
            <include name="org/jboss/ejb3/test/dependency/Customer.class"/>
            <include name="org/jboss/ejb3/test/dependency/Stateless*.class"/>
            <include name="org/jboss/ejb3/test/dependency/AnotherDependedOnMBean.class"/>
            <exclude name="org/jboss/ejb3/test/dependency/*2*.class"/>
         </fileset>
         <fileset dir="${resources}/test/dependency">
            <include name="META-INF/persistence.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/A.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dependency/ABean.class"/>
            <include name="org/jboss/ejb3/test/dependency/A.class"/>
            <include name="org/jboss/ejb3/test/dependency/B.class"/>
            <!--exclude name="org/jboss/ejb3/test/dependency/Another*.class"/-->
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/B.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dependency/BBean.class"/>
            <include name="org/jboss/ejb3/test/dependency/B.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/ejbdepends.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dependency/*2*.class"/>
         </fileset>
         <fileset dir="${resources}/test/dependency/session2">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/dependedon.sar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dependency/Depended*.class"/>
         </fileset>
         <fileset dir="${resources}/test/dependency/dependedon">
            <include name="META-INF/jboss-service.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/anotherdependedon.sar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dependency/Another*.class"/>
         </fileset>
         <fileset dir="${resources}/test/dependency/another">
            <include name="META-INF/jboss-service.xml"/>
         </fileset>
      </jar>

    <jar jarfile="${build.lib}/yetanother.sar">
       <fileset dir="${build.classes}">
          <include name="org/jboss/ejb3/test/dependency/Another*.class"/>
       </fileset>
       <fileset dir="${resources}/test/dependency/session2">
          <include name="META-INF/jboss-service.xml"/>
       </fileset>
    </jar>
      <jar jarfile="${build.lib}/dependency-test.ear">
         <fileset dir="${build.lib}">
            <include name="ejbjar.jar"/>
         </fileset>
         <fileset dir="${resources}/test/dependency">
            <include name="mydatasource-ds.xml"/>
            <include name="META-INF/application.xml"/>
            <include name="META-INF/jboss-app.xml"/>
         </fileset>
      </jar>



   </target>

   <target name="benchmark">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/benchmark-ejb3.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/microbench/StatelessBean.class"/>
            <include name="org/jboss/ejb3/test/microbench/StatelessRemote.class"/>
            <include name="org/jboss/ejb3/test/microbench/StatelessLocal.class"/>
            <include name="org/jboss/ejb3/test/microbench/StatelessTest.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/benchmark.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/microbench/StatelessBean21.class"/>
            <include name="org/jboss/ejb3/test/microbench/StatelessRemote21.class"/>
            <include name="org/jboss/ejb3/test/microbench/StatelessLocal21.class"/>
            <include name="org/jboss/ejb3/test/microbench/StatelessHomeRemote.class"/>
            <include name="org/jboss/ejb3/test/microbench/StatelessHomeLocal.class"/>
         </fileset>
         <fileset dir="${resources}/test/microbench">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>


      <jar jarfile="${build.lib}/benchmark-ejb3-test.sar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/microbench/Bench*.class"/>
         </fileset>
         <fileset dir="${resources}/test/microbench">
            <include name="META-INF/jboss-service.xml"/>
         </fileset>
         <fileset dir="${build.lib}">
            <include name="benchmark-ejb3.jar"/>
            <include name="benchmark.jar"/>
         </fileset>
      </jar>
   </target>

   <target name="appclient">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/appclient-test-client.jar" manifest="${resources}/test/appclient/Manifest">
         <zipfileset prefix="META-INF" dir="${resources}/test/appclient">
            <include name="application-client.xml"/>
            <include name="jboss-client.xml"/>
         </zipfileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/appclient/HelloWorldService.class"/>
            <include name="org/jboss/ejb3/test/appclient/client/HelloWorldClient.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/appclient-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/appclient/*.class"/>
         </fileset>
      </jar>

      <ear appxml="${resources}/test/appclient/application.xml" earfile="${build.lib}/appclient-test.ear">
         <fileset dir="${build.lib}">
            <include name="appclient-test-client.jar"/>
            <include name="appclient-test.jar"/>
         </fileset>
      </ear>

      <jar jarfile="${build.lib}/appclient-simpleresource-client.jar">
         <manifest>
            <attribute name="Main-Class" value="org.jboss.ejb3.test.appclient.client.SimpleResourceClient"/>
         </manifest>
         <zipfileset prefix="META-INF" dir="${resources}/test/appclient/simpleresource">
            <include name="application-client.xml"/>
         </zipfileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/appclient/client/SimpleResourceClient.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/appclient-simpleresource.ear">
         <fileset dir="${build.lib}">
            <include name="appclient-simpleresource-client.jar"/>
         </fileset>
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/appclient">
            <include name="appclient-jms-service.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="asynchronous">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/asynchronous-test.sar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/asynchronous/Tester*.class"/>
         </fileset>
         <fileset dir="${resources}/test/asynchronous">
            <include name="META-INF/jboss-service.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/asynchronous-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/asynchronous/*.class"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
         <fileset dir="${resources}/test/asynchronous">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="localcall">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/localcall-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/localcall/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="webservices">

      <mkdir dir="${build.lib}"/>

      <copy todir="${build.classes}">
         <fileset dir="${resources}/test/webservices">
            <include name="org/jboss/ejb3/test/webservices/*.xml"/>
         </fileset>
      </copy>

      <jar jarfile="${build.lib}/webservices-ejb3.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/webservices/*.class"/>
            <include name="org/jboss/ejb3/test/webservices/*.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/webservices-ejb3-client.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/webservices/*.class"/>
            <include name="org/jboss/ejb3/test/webservices/*.xml"/>
         </fileset>
         <fileset dir="${resources}/test/webservices">            
            <include name="META-INF/*.xml"/>
            <include name="META-INF/wsdl/*.wsdl"/>
            <include name="META-INF/wsdl/*.xml"/>            
         </fileset>
      </jar>
   </target>

   <target name="interceptors">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/interceptors-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/interceptors/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/interceptors">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="interceptors2">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/interceptors2-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/interceptors2/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/interceptors2">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/interceptors2">
            <include name="*.xml"/>
         </fileset>
      </copy>

   </target>

   <target name="interceptors3">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/interceptors3-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/interceptors3/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/interceptors3">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/interceptors3">
            <include name="*.xml"/>
         </fileset>
      </copy>

   </target>

   <target name="cachepassivation" >
   </target>
   
   <target name="clientinterceptor">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/clientinterceptor-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clientinterceptor/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/clientinterceptor">
            <include name="*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="threadlocal">
   </target>
   
   <target name="timer">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/timer-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/timer/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="timerdependency">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/timerdependency.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/timerdependency/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="pkg">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/pkg-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/pkg/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/entity">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="txexceptions">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/txexceptions-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/txexceptions/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/txexceptions">
            <include name="META-INF/persistence.xml"/>
            <include name="META-INF/ejb-jar.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="pool">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/pool.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/pool/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="naming">

      <mkdir dir="${build.lib}"/>

	<delete file="${resources}/test/naming/META-INF/jboss.xml"/>
	<copy file="${resources}/test/naming/META-INF/jboss1.xml" tofile="${resources}/test/naming/META-INF/jboss.xml"/>
      <jar jarfile="${build.lib}/naming.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/naming/Test*.class"/>
         </fileset>
         <fileset dir="${resources}/test/naming">
		<include name="*.xml"/>
            <include name="*.properties"/>
         </fileset>
         <fileset dir="${resources}/test/naming">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <delete file="${resources}/test/naming/META-INF/jboss.xml"/>
	<copy file="${resources}/test/naming/META-INF/jboss2.xml" tofile="${resources}/test/naming/META-INF/jboss.xml"/>
      <jar jarfile="${build.lib}/naming-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/naming/Stateful.class"/>
            <include name="org/jboss/ejb3/test/naming/StatefulOverrideBean.class"/>
         </fileset>
         <fileset dir="${resources}/test/naming">
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <delete file="${resources}/test/naming/META-INF/jboss.xml"/>
      <jar jarfile="${build.lib}/bind-failure-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/naming/Stateful*.class"/>
            <exclude name="org/jboss/ejb3/test/naming/StatefulOverrideBean.class"/>
         </fileset>
      </jar>

      <!-- bad-field-method.jar -->
      <jar destfile="${build.lib}/bad-field-method.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/naming/bad/BadInjector.class"/>
            <include name="org/jboss/ejb3/test/naming/bad/BadFieldMethodBean.class"/>
         </fileset>
         <zipfileset dir="${resources}/test/naming-errors"
            fullpath="META-INF/ejb-jar.xml">
            <include name="ejb-jar-method-field.xml"/>
         </zipfileset>
      </jar>
   </target>

   <target name="bmt">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/bmt-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/bmt/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/bmt">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="schema">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbjar-validation.jar">
         <fileset dir="${resources}/test/schema">
            <include name="META-INF/ejb-jar.xml"/>
         </fileset>
      </jar>

       <jar jarfile="${build.lib}/jboss-validation.jar">
         <fileset dir="${resources}/test/schema">
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="bank">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/bank.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/bank/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/bank/ejbutil/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/bank">
            <include name="META-INF/*.xml"/>
            <include name="bank-ejb3-interceptors-aop.xml"/>
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>
   </target>

   <!--target name="transaction"
      description="Builds all jar files."
      depends="compile-classes">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/transaction-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/transaction/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/transaction">
            <include name="META-INF/*.xml"/>
            <include name="*.xml"/>
         </fileset>
      </jar>
   </target-->

   <target name="mail">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/mail-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/mail/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/mail">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="security5">

      <mkdir dir="${build.lib}"/>
        <jar jarfile="${build.lib}/security5.jar">
	       <fileset dir="${build.classes}">
              <include name="org/jboss/ejb3/test/security5/*.class"/>
	       </fileset>
	       <fileset dir="${resources}/test/security5">
	          <include name="META-INF/*.xml"/> 
	       </fileset>
           <fileset dir="${resources}/test/securitydomain"> 
              <include name="users.properties"/>
	          <include name="roles.properties"/>
           </fileset>
	    </jar>
    </target>
	
   <target name="securitydomain">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/securitydomain.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/securitydomain/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/securitydomain">
            <include name="META-INF/*.xml"/>
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>
   </target>

   <target name="unauthenticatedprincipal">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/unauthenticatedprincipal.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/unauthenticatedprincipal/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/unauthenticatedprincipal">
            <include name="META-INF/*.xml"/>
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>
   </target>

   <target name="reference21_30">

      <mkdir dir="${build.lib}"/>

   <delete file="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
   <copy file="${resources}/test/reference21_30/META-INF/global-ejb-jar.xml" tofile="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
	<delete file="${resources}/test/reference21_30/META-INF/jboss.xml"/>
   	<copy file="${resources}/test/reference21_30/META-INF/jboss-reference.xml" tofile="${resources}/test/reference21_30/META-INF/jboss.xml"/>

   <jar jarfile="${build.lib}/globalReference.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/reference21_30/*21*.class"/>
         </fileset>
         <fileset dir="${resources}/test/reference21_30">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/globalReference-ejb3.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/reference21_30/GlobalSession30Bean.class"/>
            <include name="org/jboss/ejb3/test/reference21_30/Session30RemoteBusiness.class"/>
            <include name="org/jboss/ejb3/test/reference21_30/Session30.class"/>
         </fileset>
      </jar>

      <delete file="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
      <copy file="${resources}/test/reference21_30/META-INF/reference-ejb-jar.xml" tofile="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
      <delete file="${resources}/test/reference21_30/META-INF/jboss.xml"/>
   	<copy file="${resources}/test/reference21_30/META-INF/jboss-reference2.xml" tofile="${resources}/test/reference21_30/META-INF/jboss.xml"/>
      <jar jarfile="${build.lib}/reference.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/reference21_30/Local*.class"/>
            <include name="org/jboss/ejb3/test/reference21_30/Homed*.class"/>
            <include name="org/jboss/ejb3/test/reference21_30/Session*.class"/>
            <include name="org/jboss/ejb3/test/reference21_30/StatefulSession*.class"/>
         </fileset>
         <fileset dir="${resources}/test/reference21_30">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
       </jar>

       <delete file="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
      <copy file="${resources}/test/reference21_30/META-INF/ejb-jar2.xml" tofile="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
      <delete file="${resources}/test/reference21_30/META-INF/jboss.xml"/>
   	<copy file="${resources}/test/reference21_30/META-INF/jboss2.xml" tofile="${resources}/test/reference21_30/META-INF/jboss.xml"/>
	<jar jarfile="${build.lib}/multideploy.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/reference21_30/Test2*.class"/>
            <include name="org/jboss/ejb3/test/reference21_30/Test3Business.class"/>
            <include name="org/jboss/ejb3/test/reference21_30/Test3Home.class"/>
         </fileset>
         <fileset dir="${resources}/test/reference21_30">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
       </jar>

      <delete file="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
      <copy file="${resources}/test/reference21_30/META-INF/ejb-jar3.xml" tofile="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
      <delete file="${resources}/test/reference21_30/META-INF/jboss.xml"/>
   	<copy file="${resources}/test/reference21_30/META-INF/jboss3.xml" tofile="${resources}/test/reference21_30/META-INF/jboss.xml"/>
	<jar jarfile="${build.lib}/multideploy-ejb3.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/reference21_30/Test3*.class"/>
         </fileset>
         <fileset dir="${resources}/test/reference21_30">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
       </jar>


       <delete file="${resources}/test/reference21_30/META-INF/ejb-jar.xml"/>
       <delete file="${resources}/test/reference21_30/META-INF/jboss.xml"/>

       	<ear earfile="${build.lib}/multideploy.ear"
			appxml="${build.resources}/test/reference21_30/META-INF/application.xml">
	         <fileset dir="${build.lib}">
	            <include name="multideploy.jar"/>
	            <include name="multideploy-ejb3.jar"/>
	         </fileset>
	 	</ear>
   </target>

   <!--target name="jca"
      description="Builds all jar files."
      depends="compile-classes">

      <mkdir dir="${build.lib}"/>

      <jar destfile="${build.lib}/jca.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jca/**"/>
         </fileset>
      </jar>
      <jar destfile="${build.lib}/jca.rar">
         <fileset dir="${build.lib}">
            <include name="jca.jar"/>
         </fileset>
         <fileset dir="${build.resources}/test/jca">
            <include name="META-INF/ra.xml"/>
         </fileset>
      </jar>

      <jar destfile="${build.lib}/jcamdb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jca/**"/>
         </fileset>
      </jar>
   </target-->

   <target name="dd/mdb"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/dd-mdb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dd/mdb/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/dd/mdb">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/dd/mdb">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="jms"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/jms.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jms/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/jms">
            <include name="*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="jms/managed"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/jms-managed.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jms/managed/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/jms">
            <include name="*.xml"/>
         </fileset>
         <fileset dir="${resources}/test/jms/managed">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="enventry"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/enventry.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/enventry/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/enventry">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
      
      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/enventry">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <!--target name="loginmodule"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/loginmodule.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/loginmodule/*Login*.class"/>
         </fileset>
         <fileset dir="${resources}/test/loginmodule">
            <include name="*.properties"/>
         </fileset>

      </jar>

      <war warfile="${build.lib}/loginmodule.war"
         webxml="${build.resources}/test/loginmodule/WEB-INF/web.xml">
         <classes dir="${build.classes}">
            <include name="org/jboss/ejb3/test/loginmodule/*.class"/>
            <exclude name="org/jboss/ejb3/test/loginmodule/Login*.class"/>
         </classes>
      </war>
   </target-->

   <target name="dd/web"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/dd-web-ejbs.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dd/web/ejb/*.class"/>
            <include name="org/jboss/ejb3/test/dd/web/interfaces/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/dd/web">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
            <include name="META-INF/persistence.xml"/>
         </fileset>
         <fileset dir="${resources}/test/dd/web">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>

      <war warfile="${build.lib}/dd-web.war"
         webxml="${build.resources}/test/dd/web/WEB-INF/jbosstest-web.xml">
         <webinf dir="${build.resources}/test/dd/web/html/jbosstest/WEB-INF">
            <include name="*"/>
         </webinf>
         <lib dir="${build.resources}/test/dd/web/WEB-INF/lib">
        <!--    <include name="jbosstest-web-util.jar"/> -->
            <include name="resources.jar"/>
         </lib>
         <classes dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dd/web/servlets/**"/>
            <include name="org/jboss/ejb3/test/dd/web/util/*.class"/>
         </classes>
         <fileset dir="${build.resources}/test/dd/web/html/jbosstest">
            <include name="**/*.jsp"/>
            <include name="**/*.html"/>
         </fileset>
         <fileset dir="${source.java}/org/jboss/ejb3/test/dd/web/jsp">
            <include name="*.jsp"/>
         </fileset>
      </war>

      <ear earfile="${build.lib}/dd-web.ear"
         appxml="${build.resources}/test/dd/web/META-INF/application.xml">
         <metainf dir="${build.resources}/test/dd/web/META-INF">
            <include name="jboss-app.xml"/>
         </metainf>
         <fileset dir="${build.lib}">
            <include name="dd-web-ejbs.jar"/>
            <include name="dd-web.war"/>
         </fileset>
         <fileset dir="${build.resources}/test/dd/web">
            <include name="scripts/*"/>
         </fileset>
      </ear>
   </target>

   <target name="jsp"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/jsp-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jsp/*.class"/>
         </fileset>
      </jar>

      <war warfile="${build.lib}/jsp-test.war"
         webxml="${build.resources}/test/jsp/WEB-INF/jbosstest-jsp.xml">
         <fileset dir="${build.resources}/test/jsp">
            <include name="**/*.jsp"/>
         </fileset>
      </war>

      <ear earfile="${build.lib}/jsp-test.ear"
         appxml="${build.resources}/test/jsp/META-INF/application.xml">
         <fileset dir="${build.lib}">
            <include name="jsp-test.jar"/>
            <include name="jsp-test.war"/>
         </fileset>
      </ear>
   </target>

   <target name="classloader"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/classloader.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/classloader/Session30*.class"/>
         </fileset>
         <fileset dir="${resources}/test/classloader">
            <include name="META-INF/jboss.xml"/>
            <include name="*.jar"/>
            <include name="*.properties"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/classloader-shared.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/classloader/Shared*.class"/>
            <include name="org/jboss/ejb3/test/classloader/Session30.class"/>
         </fileset>
         <fileset dir="${resources}/test/classloader">
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/classloader-unshared.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/classloader/Unshared*.class"/>
            <include name="org/jboss/ejb3/test/classloader/Session30.class"/>
         </fileset>
      </jar>
   </target>

   <target name="clusteredservice"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/clusteredservice.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredservice/*.class"/>
            <exclude name="org/jboss/ejb3/test/clusteredservice/ServiceWeb.class"/>
         </fileset>
      </jar>

      <war warfile="${build.lib}/clusteredservice.war"
         webxml="${build.resources}/test/clusteredservice/WEB-INF/web.xml">
         <classes dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredservice/servlets/*.class"/>
            <include name="org/jboss/ejb3/test/clusteredservice/ServiceRemote.class"/>
            <include name="org/jboss/ejb3/test/clusteredservice/ServiceWeb.class"/>
         </classes>
      </war>
   </target>

   <target name="clusteredjms"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/clusteredjms-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredjms/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree440"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree440.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree440/session/**/*.class"/>
            <include name="org/jboss/ejb3/test/regression/ejbthree440/model/*.class"/>
         </fileset>
         <fileset dir="${build.resources}/test/regression/ejbthree440">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <ear earfile="${build.lib}/ejbthree440.ear"
         appxml="${build.resources}/test/regression/ejbthree440/META-INF/application.xml">
         <fileset dir="${build.lib}">
            <include name="ejbthree440.jar"/>
         </fileset>
      </ear>

   </target>


   <target name="ejbthree454"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/shared-a-ejb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree454/Shared*.class"/>
         </fileset>
         <fileset dir="${build.resources}/test/regression/ejbthree454/a">
            <include name="META-INF/ejb-jar.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/shared-b-ejb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree454/Shared*.class"/>
         </fileset>
         <fileset dir="${build.resources}/test/regression/ejbthree454/b">
            <include name="META-INF/ejb-jar.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/a-ejb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree454/A*.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/b-ejb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree454/B*.class"/>
         </fileset>
      </jar>
      <ear earfile="${build.lib}/ejbthree454-a.ear"
         appxml="${build.resources}/test/regression/ejbthree454/a/META-INF/application.xml">
         <fileset dir="${build.lib}">
            <include name="a-ejb.jar"/>
            <include name="shared-a-ejb.jar"/>
         </fileset>
      </ear>
      <ear earfile="${build.lib}/ejbthree454-b.ear"
         appxml="${build.resources}/test/regression/ejbthree454/b/META-INF/application.xml">
         <fileset dir="${build.lib}">
            <include name="b-ejb.jar"/>
            <include name="shared-b-ejb.jar"/>
         </fileset>
      </ear>
   </target>

   <target name="ejbthree471" >
      <build-simple-jar name="ejbthree471"/>
   </target>

   <target name="ejbthree485"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree485.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree485/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree620"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree620.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree620/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree653"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree653.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree653/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree670"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree670.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree670/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree712"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree712.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree712/*.class"/>
         </fileset>
         <zipfileset dir="${build.resources}/test/ejbthree712" prefix="META-INF" includes="*"/>
      </jar>
   </target>

   <target name="ejbthree724"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree724-persistence.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree724/Person.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/ejbthree724-session.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree724/MyStateless*.class"/>
         </fileset>
         <zipfileset dir="${build.resources}/test/ejbthree724" includes="META-INF/persistence.xml"/>
      </jar>

      <ear earfile="${build.lib}/ejbthree724.ear" appxml="${build.resources}/test/ejbthree724/META-INF/application.xml">
         <fileset dir="${build.lib}" includes="ejbthree724-*.jar"/>
      </ear>
   </target>

   <target name="ejbthree751"
      description="Builds all jar files.">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree751-fail.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree751/fail/*.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/ejbthree751-pass.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree751/pass/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree785" >
      <build-simple-jar name="ejbthree785"/>
   </target>
   
   <target name="ejbthree786" >
      <build-simple-jar name="ejbthree786"/>
   </target>
   
   <target name="ejbthree832"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree832.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree832/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree832">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree921"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree921.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree921/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree921"/>
      </jar>
   </target>

   <target name="ejbthree936"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree936.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree936/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree936"/>
      </jar>
   </target>

   <target name="ejbthree939"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree939.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree939/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree939" includes="META-INF/*"/>
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/ejbthree939">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="ejbthree953"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree953.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree953/*.class"/>
         </fileset>
         <!--fileset dir="${resources}/test/ejbthree953" includes="META-INF/*"/-->
      </jar>
   </target>

   <target name="ejbthree957"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree957-one.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree957/DestBean.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree957/one" includes="META-INF/*"/>
      </jar>

      <jar jarfile="${build.lib}/ejbthree957-two.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree957/MyStateless*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree957/two" includes="META-INF/*"/>
      </jar>

      <jar jarfile="${build.lib}/ejbthree957.ear">
         <fileset dir="${build.lib}" includes="ejbthree957-*.jar">
         </fileset>
         <!--
         <fileset dir="${resources}/test/ejbthree957/ear" includes="META-INF/*"/>
         -->
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/ejbthree957">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>
	
   <target name="epcpropagation"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/epcpropagation-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/epcpropagation/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/epcpropagation"/>
      </jar>
   </target>

   <target name="ejbthree959"
      description="Builds a simple jar files."
      >

      <build-simple-jar name="ejbthree959"/>
   </target>

   <target name="ejbthree963"
      description="Builds a simple jar files."
      >

      <build-simple-jar name="ejbthree963"/>
   </target>

   <target name="ejbthree967"
      description="Builds a simple jar files."
      >

      <build-simple-jar name="ejbthree967"/>
   </target>

   <target name="ejbthree971"
      description="Builds a simple jar files."
      >

      <build-simple-jar name="ejbthree971"/>
   </target>

   <target name="ejbthree973"
      description="Builds a simple jar files."
      >

      <build-simple-jar name="ejbthree973"/>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/ejbthree973">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="ejbthree985"
      description="Builds a simple jar file."
      >

      <build-simple-jar name="ejbthree985"/>
   </target>

   <target name="ejbthree986"
      description="Builds a simple jar file."
      >

      <build-simple-jar name="ejbthree986"/>
   </target>
	
   <target name="ejbthree987"
      description="Builds a simple jar files."
      >
      
      <build-simple-jar name="ejbthree987"/>
   </target>
   
   <target name="ejbthree994"
      description="Builds a simple jar files."
      >
      
      <build-simple-jar name="ejbthree994"/>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/ejbthree994">
            <include name="ejbthree994-connectors-jboss-beans.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="ejbthree989"
      description="Builds a simple jar file."
      >

      <build-simple-jar name="ejbthree989"/>
   </target>
  
   <target name="ejbthree1020"
      description="Builds a simple jar file."
      >

      <build-simple-jar name="ejbthree1020"/>
   </target>

   <target name="ejbthree1023"
      description="Builds a simple jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree1023.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree1023/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree1023">
            <include name="*.xml"/>
         </fileset>
      </jar>
   </target>
	   
   <target name="ejbthree1025"
      description="Builds a simple jar files."
      >
      
      <build-simple-jar name="ejbthree1025"/>
   </target>
	
   <target name="ejbthree1028" description="Builds a simple jar file.">
      <build-simple-jar name="ejbthree1028"/>
   </target>
   
	<target name="ejbthree1040"
      description="Builds a simple jar files."
      >	      
      <build-simple-jar name="ejbthree1040"/>
   </target>

   <target name="ejbthree1057" >
      <build-simple-jar name="ejbthree1057"/>
   </target>
   
  <target name="ejbthree1059" >
    <mkdir dir="${build.lib}"/>
    <jar jarfile="${build.lib}/ejbthree1059-local.jar">
      <fileset dir="${build.classes}">
        <include name="org/jboss/ejb3/test/ejbthree1059/local/*.class"/>
      </fileset>
    </jar>
    <jar jarfile="${build.lib}/ejbthree1059-remote.jar">
      <fileset dir="${build.classes}">
        <include name="org/jboss/ejb3/test/ejbthree1059/remote/*.class"/>
      </fileset>
    </jar>
  </target>
  
   <target name="ejbthree1060" >
      <build-simple-jar name="ejbthree1060"/>
   </target>
   
   <target name="ejbthree1062" >
      <build-simple-jar name="ejbthree1062"/>
   </target>
   
   <target name="ejbthree1066" >
      <build-simple-jar name="ejbthree1066"/>
   </target>
	
   <target name="ejbthree1071" >
      <build-simple-jar name="ejbthree1071"/>
   </target>

   <target name="ejbthree1075" >
   <mkdir dir="${build.lib}"/>
      <jar jarfile="${build.lib}/ejbthree1075-homeonly.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree1075/homeonly/*.class"/>
         </fileset>
      </jar>
        <jar jarfile="${build.lib}/ejbthree1075-remoteonly.jar">
           <fileset dir="${build.classes}">
              <include name="org/jboss/ejb3/test/ejbthree1075/remoteonly/*.class"/>
           </fileset>
        </jar>
   </target>
   
   <target name="ejbthree1082" >
      <build-simple-jar name="ejbthree1082"/>
   </target>
	
   <target name="ejbthree1116" >
      <build-simple-jar name="ejbthree1116"/>
   </target>
	
   <target name="ejbthree1119" >
      <build-simple-jar name="ejbthree1119"/>
   </target>
   
   <target name="ejbthree1122" >
      <build-simple-jar name="ejbthree1122"/>
   </target>
	
   <target name="ejbthree1123" >
      <build-simple-jar name="ejbthree1123"/>
   
   <copy todir="${build.lib}">
      <fileset dir="${resources}/test/ejbthree1123">
         <include name="*.xml"/>
      </fileset>
   </copy>
   	
   </target>
	
   <target name="ejbthree1127" >
      <build-simple-jar name="ejbthree1127"/>
   </target>
	
   <target name="ejbthree1130" >
      <build-simple-jar name="ejbthree1130"/>
   </target>
	
   <target name="ejbthree1146" >
      <build-simple-jar name="ejbthree1146"/>
   </target>
	
   <target name="ejbthree1148" >
      <build-simple-jar name="ejbthree1148"/>
   </target>
	
   <target name="ejbthree1154" >
      <build-simple-jar name="ejbthree1154"/>
   </target>
	
   <target name="ejbthree1157" >
      <build-simple-jar name="ejbthree1157"/>
   </target>
  
   <target name="ejbthree1222" >
      <build-simple-jar name="ejbthree1222"/>
   </target>
  
   <target name="ejbthree1271">
      <build-simple-jar name="ejbthree1271"/>
   </target>
	
   <target name="ejbthree1339">
      <build-simple-jar name="ejbthree1339"/>
   </target>

   <target name="ejbthree1504">
      <build-simple-jar name="ejbthree1504"/>
   </target>  
	
   <target name="ejbthree1530">
      <build-simple-jar name="ejbthree1530"/>
   </target> 
	
   <target name="ejbthree1624">
      <build-simple-jar name="ejbthree1624"/>
   </target>
	
	 <target name="ejbthree1647">
	    <build-simple-jar name="ejbthree1647"/>
	 </target>
	
   <target name="jbas4489"
      description="Builds a simple jar files."
      >
      
      <build-simple-jar name="jbas4489"/>
   </target>
   
   <target name="jaxws"
      description="Builds a simple jar."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/jaxws-context.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jaxws/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="wolfc"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/wolfc.jar">
         <zipfileset prefix="META-INF" dir="${build.resources}/test/wolfc">
            <include name="persistence.xml"/>
         </zipfileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/wolfc/*.class"/>
         </fileset>
      </jar>

      <ear destfile="${build.lib}/wolfc.ear" appxml="${build.resources}/test/wolfc/application.xml">
         <zipfileset prefix="META-INF" dir="${build.resources}/test/wolfc">
            <include name="jboss-app.xml"/>
         </zipfileset>
         <fileset dir="${build.lib}" includes="wolfc.jar"/>
      </ear>
   </target>

   <target name="scopedclassloader"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/search-ejbs.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/StatelessBean.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/StatelessRemote.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/ValueObject.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/Customer.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/ScopedException.class"/>
         </fileset>
         <fileset dir="${build.resources}/test/scopedclassloader/ejbear">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/sf-clientejb.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/Client*.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/StatelessRemote.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/ValueObject.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/Customer.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/ScopedException.class"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/search-ejbs-client.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/ValueObject.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/StatelessRemote.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/Customer.class"/>
            <include name="org/jboss/ejb3/test/regression/scopedclassloader/ScopedException.class"/>
         </fileset>
      </jar>

      <war warfile="${build.lib}/webtools.war"
              manifest="${build.resources}/test/scopedclassloader/webtools/META-INF/MANIFEST.MF"
         webxml="${build.resources}/test/scopedclassloader/webtools/WEB-INF/web.xml">
         <fileset dir="${build.resources}/test/scopedclassloader/webtools">
            <include name="*.jsp"/>
         </fileset>
      </war>

      <ear earfile="${build.lib}/scopedclassloader-web.ear"
         appxml="${build.resources}/test/scopedclassloader/webear/META-INF/application.xml">
         <metainf dir="${build.resources}/test/scopedclassloader/webear/META-INF">
            <include name="jboss-app.xml"/>
         </metainf>
         <fileset dir="${build.lib}">
            <include name="sf-clientejb.jar"/>
            <include name="search-ejbs-client.jar"/>
            <include name="webtools.war"/>
         </fileset>
      </ear>

      <ear earfile="${build.lib}/scopedclassloader-ejb.ear"
         appxml="${build.resources}/test/scopedclassloader/ejbear/META-INF/application.xml">
         <metainf dir="${build.resources}/test/scopedclassloader/ejbear/META-INF">
            <include name="jboss-app.xml"/>
         </metainf>
         <fileset dir="${build.lib}">
            <include name="search-ejbs.jar"/>
         </fileset>
      </ear>

   </target>

   <target name="exception"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/exception.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/exception/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="dd/override"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <copy file="${resources}/test/dd/override/META-INF/ejb-jarB.xml" tofile="${resources}/test/dd/override/META-INF/ejb-jar.xml"/>

      <jar jarfile="${build.lib}/dd-override1B.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dd/override/FooBean1.class"/>
            <include name="org/jboss/ejb3/test/dd/override/Foo.class"/>
            <include name="org/jboss/ejb3/test/dd/override/LocalFoo.class"/>
            <include name="org/jboss/ejb3/test/dd/override/LocalFooBean.class"/>
         </fileset>
         <fileset dir="${resources}/test/dd/override">
            <include name="META-INF/ejb-jar.xml"/>
         </fileset>
      </jar>
   </target>


   <target name="hbm"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/hbm-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/hbm/*.class"/>
            <exclude name="org/jboss/ejb3/test/hbm/HBM2.class"/>
         </fileset>
         <fileset dir="${resources}/test/hbm">
           <include name="META-INF/hbm.hbm.xml"/>
	     <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/hbm2-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/hbm/HBM2.class"/>
         </fileset>
         <fileset dir="${resources}/test/hbm">
           <include name="META-INF/hbm2.hbm.xml"/>
         </fileset>
         <fileset dir="${resources}/test/hbm/hbm2">
           <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="regressionHHH275"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/regressionHHH275-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regressionHHH275/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/regressionHHH275">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="regression"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/salesforce-7123.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/salesforce7123/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/regression/salesforce7123">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/*.class"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-ejbthree249-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree249/*.class"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-ejbthree290-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree290/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/regression/ejbthree290">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-ejbthree625-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree625/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/regression/ejbthree625">
            <include name="META-INF/ejb-jar.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-ejbthree231.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree231/*.class"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-ejbthree315.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree315/*.class"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-ejbthree316.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree316/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/regression/ejbthree316">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/regression-ejbthree376.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/regression/ejbthree376/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="strictpool"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/strictpool-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/strictpool/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/strictpool">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/strictpool">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="singleton" description="Builds jar files for the singleton unit.">
      <mkdir dir="${build.lib}"/>
      <jar jarfile="${build.lib}/singleton-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/singleton/*.class"/>
            <include name="org/jboss/ejb3/test/singleton/lock/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/singleton">
            <include name="aspectdomain-ejb3-interceptors-aop.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/singletonpool.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/singleton/pool/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/singleton">
            <include name="singleton-jboss-beans.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="relationships"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/relationships-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/relationships/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="ssl"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ssl-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ssl/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="arjuna"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/arjuna-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/arjuna/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/arjuna">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="ssladvanced"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ssladvanced-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ssladvanced/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ssladvanced">
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="entity"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/entity-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/entity/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/entity">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="entityoptimisticlocking"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/entityoptimisticlocking-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/entity/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/entityoptimisticlocking">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

	<target name="persistenceunits"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/persistenceunits-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/persistenceunits/Entity*.class"/>
         </fileset>
         <fileset dir="${resources}/test/persistenceunits">
            <include name="META-INF/persistence.xml"/>
            <include name="*.xml"/>
            <include name="*.jar"/>
         </fileset>
      </jar>
   	
	  <jar jarfile="${build.lib}/persistenceunitscope.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/persistenceunits/Entity*.class"/>
         </fileset>
	     <fileset dir="${resources}/test/persistenceunits">
	        <include name="entity2-ds.xml"/>
         </fileset>
      </jar>
	
	  <jar jarfile="${build.lib}/persistenceunitscope1.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/persistenceunits/Entity1.class"/>
	        <include name="org/jboss/ejb3/test/persistenceunits/Entity2.class"/>
         </fileset>
	     <fileset dir="${resources}/test/persistenceunits">
		    <include name="entity2-ds.xml"/>
	     </fileset>
		 <!--fileset dir="${resources}/test/persistenceunits">
            <include name="META-INF/persistence.xml"/>
         </fileset-->
      </jar>
	
	  <jar jarfile="${build.lib}/persistenceunitscope2.jar">
         <fileset dir="${build.classes}">
	        <include name="org/jboss/ejb3/test/persistenceunits/Entity1.class"/>
		    <include name="org/jboss/ejb3/test/persistenceunits/Entity2.class"/>
         </fileset>
	     <!--fileset dir="${resources}/test/persistenceunits">
            <include name="META-INF/persistence.xml"/>
         </fileset-->
      </jar>
	
	  <jar jarfile="${build.lib}/persistenceunitscope-slsb.jar">
         <fileset dir="${build.classes}">
	        <include name="org/jboss/ejb3/test/persistenceunits/EntityTest*.class"/>
         </fileset>
	     <!--fileset dir="${resources}/test/persistenceunits">
            <include name="META-INF/persistence.xml"/>
         </fileset-->
      </jar>
	
	  <ear earfile="${build.lib}/persistenceunitscope-test.ear" appxml="${resources}/test/persistenceunits/application.xml">
         <zipfileset dir="${build.lib}">
            <include name="persistenceunitscope.jar"/>
         </zipfileset>
	     <fileset dir="${resources}/test/persistenceunits">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </ear>
   	
   	  <ear earfile="${build.lib}/persistenceunitscope-test1.ear" appxml="${resources}/test/persistenceunits/application1.xml">
         <zipfileset dir="${build.lib}">
            <include name="persistenceunitscope1.jar"/>
	        <include name="persistenceunitscope-slsb.jar"/>
         </zipfileset>
	     <fileset dir="${resources}/test/persistenceunits">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </ear>
	
	  <ear earfile="${build.lib}/persistenceunitscope-test2.ear" appxml="${resources}/test/persistenceunits/application2.xml">
         <zipfileset dir="${build.lib}">
            <include name="persistenceunitscope2.jar"/>
	        <include name="persistenceunitscope-slsb.jar"/>
         </zipfileset>
	     <!--fileset dir="${resources}/test/persistenceunits">
            <include name="META-INF/persistence.xml"/>
         </fileset-->
      </ear>
   	
   	  <jar jarfile="${build.lib}/persistenceunitsharedentity1.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/persistenceunits/Entity*.class"/>
         </fileset>
	     <fileset dir="${resources}/test/persistenceunits">
	        <include name="entity2-ds.xml"/>
	        <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
	
	  <jar jarfile="${build.lib}/persistenceunitsharedentity2.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/persistenceunits/Service*.class"/>
         </fileset>
	     <fileset dir="${resources}/test/persistenceunits">
	        <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
	
	  <ear earfile="${build.lib}/persistenceunitsharedentity-test.ear" appxml="${resources}/test/persistenceunits/sharedEntityApplication.xml">
         <zipfileset dir="${build.lib}">
            <include name="persistenceunitsharedentity1.jar"/>
			<include name="persistenceunitsharedentity2.jar"/>
         </zipfileset>
      </ear>
   </target>

   <target name="mdbtransactions"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/mdbtransactions-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/mdbtransactions/*.class"/>
            <exclude name="org/jboss/ejb3/test/mdbtransactions/*21.class"/>
         </fileset>
         <fileset dir="${resources}/test/mdbtransactions">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/mdbtransactions21-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/mdbtransactions/*21.class"/>
         </fileset>
         <fileset dir="${resources}/test/mdbtransactions">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/mdbtransactions">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="lifecycle" >
      <build-simple-jar name="lifecycle"/>
   </target>
   
   <target name="longlived"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/longlived-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/longlived/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/longlived">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="entityexception"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/entityexception-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/entityexception/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/entityexception">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="composite"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/composite-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/composite/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/composite">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="composite2"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/composite2-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/composite2/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/composite2">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="lob"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/lob-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/lob/*.class"/>
         </fileset>
          <fileset dir="${resources}/test/lob">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="manytomany"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/manytomany-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/manytomany/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/manytomany">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="joininheritance"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/join-inheritance-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/joininheritance/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/joininheritance">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="singletable"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/single-table-inheritance-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/singletableinheritance/*.class"/>
         </fileset>
          <fileset dir="${resources}/test/singletable">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="invalidtxmdb"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/invalidtxmdb">
            <include name="*.xml"/>
         </fileset>
      </copy>

      <jar jarfile="${build.lib}/invalidtxmdb-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/invalidtxmdb/*.class"/>
         </fileset>
      </jar>
   </target>
	
   <target name="mdb"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/mdb-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/mdb/*.class"/>
            <include name="org/jboss/ejb3/test/mdb/unit/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/mdb">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
         <fileset dir="${resources}/test/mdb">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/mdb">
            <include name="*.xml"/>
         </fileset>
      </copy>

   </target>

   <target name="mdbtopic"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/mdbtopic-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/mdbtopic/*.class"/>
            <include name="org/jboss/ejb3/test/mdbtopic/unit/*.class"/>
         </fileset>
         <!--
         <fileset dir="${resources}/test/mdb">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
         <fileset dir="${resources}/test/mdb">
            <include name="META-INF/*.xml"/>
         </fileset>
         -->
      </jar>
   </target>

   <target name="concurrent"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/concurrent.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/concurrent/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="consumer"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/consumer-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/consumer/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/consumer">
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/consumer">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="tableperclass"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/table-per-class-inheritance-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/tableperinheritance/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/tableperinheritance">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="dependent"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/dependent-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/dependent/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/dependent">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="descriptortypo"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/descriptortypo-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/descriptortypo/**/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/descriptortypo">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   </target>
	
   <target name="statefulproxyfactoryoverride"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/statefulproxyfactoryoverride-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/statefulproxyfactoryoverride/*.class"/>
	        <exclude name="org/jboss/ejb3/test/statefulproxyfactoryoverride/*Factory*.class"/>
         </fileset>
      	 <fileset dir="${resources}/test/statefulproxyfactoryoverride">
  	        <include name="META-INF/*.xml"/>
  	     </fileset>
      </jar>
	
	  <jar jarfile="${resources}/test-configs/statefulproxyfactoryoverride/lib/statefulproxyfactoryoverride.jar">
         <fileset dir="${build.classes}">
	        <include name="org/jboss/ejb3/test/statefulproxyfactoryoverride/*Factory*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="stateful"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/stateful-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateful/**/*.class"/>
            <include name="org/jboss/ejb3/test/stateful/unit/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/stateful">
            <include name="META-INF/*.xml"/>
         </fileset>
         <fileset dir="${resources}/test/stateful">
            <include name="*.xml"/>
            <include name="*.properties"/>
         </fileset>
      </jar>
   </target>

   <!--target name="seam"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/seam-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/seam/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/seam">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="seam.properties"/>
         </fileset>
      </jar>
   </target-->

   <target name="aspectdomain"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/aspectdomain.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/aspectdomain/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/aspectdomain">
            <include name="*.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
   </target>
	
   <target name="ejbthree1090"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree1090-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree1090/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree1090">
            <include name="*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbcontext"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbcontext.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbcontext/*.class"/>
         </fileset>
         <!--fileset dir="${resources}/test/ejbcontext">
            <include name="META-INF/ejb-jar.xml"/>
         </fileset-->
      </jar>
   </target>

   <target name="iiop"
      description="Builds iiop.jar."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/iiop.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/iiop/*.class"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>
   </target>

   <target name="tck5sec"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/tck5sec-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/tck5sec/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/tck5sec">
            <include name="META-INF/jboss.xml"/>
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>

      <ear appxml="${resources}/test/tck5sec/META-INF/application.xml" earfile="${build.lib}/tck5sec-test.ear">
         <!--metainf dir="${build.resources}/test/tck5sec/META-INF">
            <include name="jboss-app.xml"/>
         </metainf-->
         <fileset dir="${build.lib}">
            <include name="tck5sec-test.jar"/>
         </fileset>
      </ear>
   </target>

   <target name="security"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/security-spec.sar">
        <metainf dir="${resources}/test/security-spec/META-INF" />
        <fileset dir="${resources}/test/security">
           <include name="users.properties" />
           <include name="roles.properties" />
        </fileset>
        <fileset dir="${resources}/test/security-spec">
           <include name="tst.keystore" />
        </fileset>
      </jar>

      <jar jarfile="${build.lib}/security.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/security/*.class"/>
            <exclude name="org/jboss/ejb3/test/security/UncheckedStateless*.class"/>
            <exclude name="org/jboss/ejb3/test/security/Timer*.class"/>
            <exclude name="org/jboss/ejb3/test/security/Unauthenticated*.class"/>
         </fileset>
         <fileset dir="${resources}/test/security">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      	<fileset dir="${resources}/test/security">
      	    <include name="META-INF/ejb-jar.xml"/>
      	</fileset>
      </jar>

      <jar jarfile="${build.lib}/timer-runas-security.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/security/UncheckedStateless*.class"/>
            <include name="org/jboss/ejb3/test/security/Timer*.class"/>
         </fileset>
         <fileset dir="${resources}/test/security">
            <include name="jboss-service.xml"/>
         </fileset>
         <fileset dir="${resources}/test/security">
            <include name="META-INF/jaas-test-config.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/security-extensions.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/security/Unauthenticated*.class"/>
         </fileset>
         <fileset dir="${resources}/test/security">
            <include name="META-INF/jboss.xml"/>
         </fileset>
         <fileset dir="${resources}/test/security">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>

      <copy file="${resources}/test/security/META-INF/jaas-test-config.xml" tofile="${build.classes}/jaas-test-config.xml"/>

      <war warfile="${build.lib}/security-web.war"
         webxml="${build.resources}/test/security/WEB-INF/web.xml">
         <webinf dir="${build.resources}/test/security/WEB-INF">
            <include name="jboss-web.xml"/>
         </webinf>
         <classes dir="${build.classes}">
            <include name="org/jboss/ejb3/test/security/servlets/**"/>
         </classes>
      </war>
   </target>

   <target name="homeinterface"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/homeinterface-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/homeinterface/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/homeinterface">
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="libdeployment"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/libdeployment-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/libdeployment/Stateless*.class"/>
         </fileset>
         <fileset dir="${resources}/test/libdeployment">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/libdeployment.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/libdeployment/Stateful*.class"/>
         </fileset>
      </jar>

      <copy todir="${resources}/test-configs/libdeployment/lib">
         <fileset dir="${build.lib}">
            <include name="libdeployment.jar"/>
         </fileset>
      </copy>
   </target>


   <target name="stateless"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/stateless-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateless/*.class"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>

	  <copy file="${build.lib}/stateless-test.jar" tofile="${build.lib}/stateless-test.ejb3"/>
   </target>
	
   <target name="ejbthree1092"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree1092-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree1092/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree1092">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="statelesscreation"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/statelesscreation-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/statelesscreation/*.class"/>
         </fileset>
      </jar>
      
      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/statelesscreation">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>
	
   <target name="removedislocal"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/removedislocal-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/removedislocal/*.class"/>
         </fileset>
      </jar>
   </target>

   
   <target name="defaultremotebindings"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/defaultremotebindings-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/defaultremotebindings/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/defaultremotebindings">
            <include name="*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="localfromremote"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <copy file="${resources}/test/localfromremote/jndi1.properties" tofile="${resources}/test/localfromremote/jndi.properties"/>
      <jar jarfile="${build.lib}/localfromremote-test1.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/localfromremote/*.class"/>
         </fileset>

         <fileset dir="${resources}/test/localfromremote">
            <include name="jndi.properties"/>
         </fileset>
      </jar>
      <delete file="${resources}/test/localfromremote/jndi.properties"/>
      <copy file="${build.lib}/localfromremote-test1.jar" tofile="${resources}/test-configs/localfromremote1/deploy/localfromremote-test.jar"/>

      <copy file="${resources}/test/localfromremote/jndi2.properties" tofile="${resources}/test/localfromremote/jndi.properties"/>
      <jar jarfile="${build.lib}/localfromremote-test2.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/localfromremote/*.class"/>
         </fileset>

         <fileset dir="${resources}/test/localfromremote">
            <include name="jndi.properties"/>
         </fileset>
      </jar>
      <delete file="${resources}/test/localfromremote/jndi.properties"/>
      <copy file="${build.lib}/localfromremote-test2.jar" tofile="${resources}/test-configs/localfromremote2/deploy/localfromremote-test.jar"/>
   </target>

   <target name="concurrentnaming"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/concurrentnaming-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/concurrentnaming/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="propertyreplacement"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/propertyreplacement-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/propertyreplacement/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/propertyreplacement">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>

      <copy todir="${build.lib}">
         <fileset dir="${resources}/test/propertyreplacement">
            <include name="*.xml"/>
         </fileset>
      </copy>
   </target>

   <target name="invoker"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/invoker-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/invoker/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="circulardependency"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/circulardependency-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/circulardependency/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/circulardependency">
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="changexml"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/changexml.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/changexml/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/changexml">
            <include name="META-INF/*.xml"/>
	    <include name="changexml-users.properties"/>
	    <include name="changexml-roles.properties"/>
            <include name="*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="servicedependency"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/servicedependency.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/servicedependency/*.class"/>
         </fileset>
      </jar>
   </target>

   <target name="stateless14"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/stateless14-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateless14/*.class"/>
         </fileset>
      </jar>

      <delete>
      	 <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateless14/**/*.class"/>
         </fileset>
      </delete>

     <!--
      <javac destdir="${build.classes}"
         optimize="${javac.optimize}"
         debug="${javac.debug}"
         source="1.4"
         target="1.4"
         depend="${javac.depend}"
         verbose="${javac.verbose}"
         deprecation="${javac.deprecation}"
         includeAntRuntime="${javac.include.ant.runtime}"
         includeJavaRuntime="${javac.include.java.runtime}"
         failonerror="${javac.fail.onerror}">
         <src path="${source.java}"/>
         <classpath refid="javac.classpath"/>
         <include name="org/jboss/ejb3/test/stateless14/**/*.java"/>
         <exclude name="org/jboss/ejb3/test/stateless14/**/*Bean.java"/>
      </javac>
      -->
   </target>

   <!-- TODO use the other jacc target once the jars from hibernate are updated (changes already made to hibernate) -->
      <target name="jacc"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/jacc-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jacc/*.class"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
         <fileset dir="${resources}/test/jacc">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

<!--
   <target name="jacc"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/jacc-test.par">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jacc/*Entity.class"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
         <fileset dir="${resources}/test/jacc">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/jacc-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/jacc/*.class"/>
            <exclude name="org/jboss/ejb3/test/jacc/*Entity.class"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>
   </target>
-->

   <target name="service"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/service-test.sar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/service/Tester*.class"/>
         </fileset>
         <fileset dir="${resources}/test/service">
            <include name="META-INF/jboss-service.xml"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/service-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/service/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/service">
            <include name="META-INF/ejb-jar.xml"/>
            <include name="META-INF/jboss.xml"/>
            <include name="META-INF/persistence.xml"/>
            <include name="test-destination-service.xml"/>
         </fileset>
         <fileset dir="${resources}/test">
            <include name="users.properties"/>
            <include name="roles.properties"/>
         </fileset>
      </jar>
   </target>

   <target name="entitycallback"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/entitycallback-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/entitycallback/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/entitycallback">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="secondary"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/secondary-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/secondary/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/secondary">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="xmlcfg"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/xmlcfg-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/xmlcfg/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/xmlcfg">
            <include name="META-INF/**"/>
         </fileset>
      </jar>
   </target>

   <target name="xpcalt" >
      <build-simple-jar name="xpcalt"/>
   </target>
   
   <target name="clusteredentity"
      description="Builds all jar files."
      >

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/clusteredentity-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredentity/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/clusteredentity">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

    <jar jarfile="${build.lib}/clusteredentity-optimistic-test.jar">
       <fileset dir="${build.classes}">
          <include name="org/jboss/ejb3/test/clusteredentity/*.class"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/optimistic">
          <include name="META-INF/persistence.xml"/>
       </fileset>
    </jar>

      <jar jarfile="${build.lib}/clusteredentity-classloader-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredentity/classloader/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/clusteredentity/classloader">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>

    <jar jarfile="${build.lib}/clusteredentity-classloader-optimistic-test.jar">
       <fileset dir="${build.classes}">
          <include name="org/jboss/ejb3/test/clusteredentity/classloader/*.class"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader/optimistic">
          <include name="META-INF/persistence.xml"/>
          <!--include name="META-INF/jboss.xml"/-->
       </fileset>
    </jar>

    <jar jarfile="${build.lib}/clusteredentity-classloader-test.ear">
       <fileset dir="${build.lib}">
          <include name="clusteredentity-classloader-test.jar"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader">
          <include name="META-INF/application.xml"/>
          <include name="META-INF/jboss-app.xml"/>
        <include name="clusteredentity-ds.xml"/>
       </fileset>
    </jar>

    <jar jarfile="${build.lib}/clusteredentity-classloader-optimistic-test.ear">
       <fileset dir="${build.lib}">
          <include name="clusteredentity-classloader-optimistic-test.jar"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader">
          <include name="META-INF/jboss-app.xml"/>
          <include name="clusteredentity-ds.xml"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader/optimistic">
          <include name="META-INF/application.xml"/>
          <include name="META-INF/jboss-app.xml"/>
          <include name="clusteredentity-ds.xml"/>
       </fileset>
    </jar>

    <jar jarfile="${build.lib}/clusteredentity-providedprefix-test.jar">
       <fileset dir="${build.classes}">
          <include name="org/jboss/ejb3/test/clusteredentity/classloader/*.class"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/providedprefix">
          <include name="META-INF/persistence.xml"/>
       </fileset>
    </jar>

  <jar jarfile="${build.lib}/clusteredentity-providedprefix-test.ear">
     <fileset dir="${build.lib}">
        <include name="clusteredentity-providedprefix-test.jar"/>
     </fileset>
     <fileset dir="${resources}/test/clusteredentity/providedprefix">
        <include name="META-INF/application.xml"/>
        <include name="META-INF/jboss-app.xml"/>
      <include name="clusteredentity-ds.xml"/>
     </fileset>
     <fileset dir="${resources}/test/clusteredentity/classloader">
        <include name="clusteredentity-ds.xml"/>
     </fileset>
  </jar>

    <jar jarfile="${build.lib}/clusteredentity-embeddedid-test.jar">
       <fileset dir="${build.classes}">
          <include name="org/jboss/ejb3/test/clusteredentity/embeddedid/*.class"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader">
          <include name="META-INF/persistence.xml"/>
       </fileset>
    </jar>

    <jar jarfile="${build.lib}/clusteredentity-embeddedid-optimistic-test.jar">
       <fileset dir="${build.classes}">
          <include name="org/jboss/ejb3/test/clusteredentity/embeddedid/*.class"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader/optimistic">
          <include name="META-INF/persistence.xml"/>
          <!--include name="META-INF/jboss.xml"/-->
       </fileset>
    </jar>

    <jar jarfile="${build.lib}/clusteredentity-embeddedid-test.ear">
       <fileset dir="${build.lib}">
          <include name="clusteredentity-embeddedid-test.jar"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader">
          <include name="META-INF/jboss-app.xml"/>
          <include name="clusteredentity-ds.xml"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/embeddedid">
         <include name="META-INF/application.xml"/>
       </fileset>
    </jar>

    <jar jarfile="${build.lib}/clusteredentity-embeddedid-optimistic-test.ear">
       <fileset dir="${build.lib}">
          <include name="clusteredentity-embeddedid-optimistic-test.jar"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/classloader">
          <include name="META-INF/jboss-app.xml"/>
          <include name="clusteredentity-ds.xml"/>
       </fileset>
       <fileset dir="${resources}/test/clusteredentity/embeddedid/optimistic">
         <include name="META-INF/application.xml"/>
       </fileset>
    </jar>

   </target>

   <target name="clusteredsession"
      description="Builds all jar files.">

      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/clusteredsession-test.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/util/*.class"/>
         </fileset>
        <fileset dir="${build.classes}">
           <include name="org/jboss/ejb3/test/stateful/nested/base/*.class"/>
        </fileset>
         <fileset dir="${resources}/test/clusteredsession">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   	
      <jar jarfile="${build.lib}/clusteredsession-nested.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/nested/base/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/nested/base/std/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/util/*.class"/>
         </fileset>
        <fileset dir="${build.classes}">
           <include name="org/jboss/ejb3/test/stateful/nested/base/*.class"/>
        </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateful/nested/base/std/*.class"/>
         </fileset>
      </jar>
   	
   	<copy todir="${build.lib}" file="${resources}/test/clusteredsession/xpc/clusteredsession-ds.xml"/>
   	
      <jar jarfile="${build.lib}/clusteredsession-xpc.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/nested/base/xpc/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/util/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateful/nested/base/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateful/nested/base/xpc/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/clusteredsession/xpc">
            <include name="META-INF/persistence.xml"/>
         </fileset>
      </jar>
      
      <jar jarfile="${build.lib}/clusteredsession-xpc-scoped.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/nested/base/xpc/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/util/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateful/nested/base/*.class"/>
         </fileset>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/stateful/nested/base/xpc/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/clusteredsession/xpc">
            <include name="META-INF/persistence.xml"/>
            <include name="META-INF/jboss.xml"/>
         </fileset>
      </jar>

      <jar jarfile="${build.lib}/clusteredsession-local.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/clusteredsession/islocal/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/clusteredsession/islocal">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>

	  <copy todir="${build.lib}">
	     <fileset dir="${resources}/test/clusteredsession/islocal/foreign">
	        <include name="testlocal-jboss-beans.xml"/>
	     </fileset>
	  </copy>
	
	  <jar jarfile="${build.lib}/ejbthree1136.jar">
	      <fileset dir="${build.classes}">
	         <include name="org/jboss/ejb3/test/ejbthree1136/DoNothing*.class"/>
	      </fileset>
	  </jar>
	  <jar destfile="${build.lib}/ejbthree1136.sar">
	      <metainf dir="${build.resources}/test/ejbthree1136">
	         <include name="jboss-service.xml"/>
	      </metainf>
	      <fileset dir="${build.classes}">
	         <include name="org/jboss/ejb3/test/ejbthree1136/SFSB*.class"/>
	      </fileset>
	  </jar>
   </target>

   <target name="externalrefscoped" description="Builds externalrefscoped jar files.">
      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/externalrefscoped-first-client-view.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/externalrefscoped/First.class"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/externalrefscoped-first-ejb.jar">
         <manifest>
            <attribute name="Class-Path" value="externalrefscoped-first-client-view.jar externalrefscoped-second-client-view.jar"/>
         </manifest>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/externalrefscoped/FirstBean.class"/>
         </fileset>
         <fileset dir="${resources}/test/externalrefscoped/first-ejb-jar"/>
      </jar>
      <jar jarfile="${build.lib}/externalrefscoped-second-client-view.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/externalrefscoped/Second.class"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/externalrefscoped-second-ejb.jar">
         <manifest>
            <attribute name="Class-Path" value="externalrefscoped-second-client-view.jar"/>
         </manifest>
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/externalrefscoped/SecondBean.class"/>
         </fileset>
         <fileset dir="${resources}/test/externalrefscoped/second-ejb-jar"/>
      </jar>
      <jar jarfile="${build.lib}/externalrefscoped-first.ear">
         <fileset dir="${resources}/test/externalrefscoped/first-ear"/>
         <fileset dir="${build.lib}">
            <include name="externalrefscoped-first-client-view.jar"/>
            <include name="externalrefscoped-second-client-view.jar"/>
            <include name="externalrefscoped-first-ejb.jar"/>
         </fileset>
      </jar>
      <jar jarfile="${build.lib}/externalrefscoped-second.ear">
         <fileset dir="${resources}/test/externalrefscoped/second-ear"/>
         <fileset dir="${build.lib}">
            <include name="externalrefscoped-second-client-view.jar"/>
            <include name="externalrefscoped-second-ejb.jar"/>
         </fileset>
      </jar>
   </target>
	
	
	<target name="ejbthree1671"
	      description="Builds the ear and jar file(s) needed for testing EJBTHREE-1671."
	      >

	    <mkdir dir="${build.lib}"/>
		<!--  First build the jar file containing the EJBs -->
		<jar jarfile="${build.lib}/ejbthree1671.jar">
	         <fileset dir="${build.classes}">
	            <include name="org/jboss/ejb3/test/ejbthree1671/*.class"/>
	         </fileset>
		</jar>
		<!--  Now build the EAR and include the EJB jar and the application.xml and jboss-app.xml -->
		<jar jarfile="${build.lib}/ejbthree1671.ear">
         	<fileset dir="${build.lib}">
            	<include name="ejbthree1671.jar"/>
         	</fileset>
         	<fileset dir="${resources}/test/ejbthree1671">
            	<include name="META-INF/application.xml"/>
            	<include name="META-INF/jboss-app.xml"/>
         		
         	</fileset>
      </jar>
	</target>

  <target name="ejbthree1677"
      description="Builds all jar files required to test EJBTHREE-1677."
      >
	<delete file="${build.lib}/ejbthree1677.jar"/>
      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree1677.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree1677/*.class"/>
         </fileset>
      </jar>
   </target>

	<target name="ejbthree1629"
	      description="Builds the jar file(s) needed for testing EJBTHREE-1629."
	      >

	      <delete file="${build.lib}/ejbthree1629.jar"/>
               <mkdir dir="${build.lib}"/>

		<jar jarfile="${build.lib}/ejbthree1629.jar">
	         <fileset dir="${build.classes}">
	            <include name="org/jboss/ejb3/test/ejbthree1629/*.class"/>
	         </fileset>
	         <fileset dir="${resources}/test/ejbthree1629">
	            <include name="META-INF/*.xml"/>
	         </fileset>
		</jar>
	</target>

   <target name="ejbthree1346">

      <delete file="${build.lib}/ejbthree1346.jar"/>
      <mkdir dir="${build.lib}"/>

      <jar jarfile="${build.lib}/ejbthree1346.jar">
         <fileset dir="${build.classes}">
            <include name="org/jboss/ejb3/test/ejbthree1346/*.class"/>
            <include name="org/jboss/ejb3/test/clusteredsession/NodeAnswer.class"/>
            <include name="org/jboss/ejb3/test/clusteredsession/util/*.class"/>
         </fileset>
         <fileset dir="${resources}/test/ejbthree1346">
            <include name="META-INF/*.xml"/>
         </fileset>
      </jar>
   </target>

   <target name="ejbthree1807">
  	   <build-simple-jar name="ejbthree1807"/>
   </target>

   
   <target name="jars" depends="statefulproxyfactoryoverride, removedislocal, statelesscreation, defaultremotebindings, localfromremote, clusteredjms, entityoptimisticlocking, concurrentnaming, propertyreplacement, persistenceunits, appclient, tck5sec, invalidtxmdb, descriptortypo, libdeployment, homeinterface, arjuna, mdbtransactions, unauthenticatedprincipal, clusteredservice, invoker, classloader,
      concurrent,
      circulardependency, jsp, timerdependency, servicedependency, stateless14, webservices, ear, ejbthree440,
      ejbthree454, ejbthree471, 
   	  ejbthree653, ejbthree670, ejbthree712, ejbthree724, ejbthree751,
      ejbthree785, 
      ejbthree786, 
      ejbthree832, ejbthree921, ejbthree936,
      ejbthree939,
      ejbthree953, ejbthree957, ejbthree959, ejbthree963, ejbthree967, ejbthree971, ejbthree973, ejbthree985, ejbthree986,
      ejbthree987,
      ejbthree989, ejbthree994, ejbthree1020, ejbthree1023, ejbthree1025,
      ejbthree1028,
      ejbthree1040,
      ejbthree1057, ejbthree1059, ejbthree1060,
      ejbthree1062,
      ejbthree1066, ejbthree1071, ejbthree1075, ejbthree1082, ejbthree1090, ejbthree1092, ejbthree1116, ejbthree1119, ejbthree1122, ejbthree1123, ejbthree1127,
      ejbthree1130, 
      ejbthree1146, ejbthree1148, ejbthree1154, ejbthree1157, ejbthree1222, ejbthree1271, ejbthree1339,
      ejbthree1504, ejbthree1530, ejbthree1624, ejbthree1647,
   	  jaxws, jbas4489, epcpropagation, aspectdomain, ejbcontext, schema, mail, scopedclassloader, dependency,
      securitydomain, enventry, security5,
      jms/managed, naming, bmt, jca/inflowmdb, pool, jms, security, reference21_30, factory, dd/web, txexceptions,
      exception, dd/override, stateless, dd/mdb, bank, longlived, xmlcfg, hbm, pkg, regressionHHH275,
      entityexception, asynchronous, consumer, clusteredentity, secondary, stateful, service, lob, cache, initial,
      timer, benchmark, entity, joininheritance, singletable, tableperclass, dependent, mdb, manytomany, regression,
      composite, composite2, entitycallback, relationships, ssl, ssladvanced, clusteredsession, strictpool, jacc,
      localcall, interceptors, interceptors2, interceptors3, iiop, clientinterceptor,
      statelesscreation, changexml, externalrefscoped, singleton, ejbthree1671, ejbthree1677, ejbthree1629, 
   	  ejbthree1807, ejbthree1346"/>

   <target name="test" depends="init" if="test"
      description="Execute all tests in the given test directory.">
      <!-- For use when we do not need to pass in any special jvmargs; forks the test process -->
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="${test}"/>
         <param name="jvmargs" value=""/>
      </antcall>
   </target>

   <target name="test-with-jvmargs" if="test">
      <!-- For use when we need to pass in special jvmargs -->

      <mkdir dir="${build.reports}"/>
      <mkdir dir="${build.testlog}"/>
      <!-- Remove the test.log so each run has a fresh log -->
      <delete file="${build.testlog}/test.log"/>

     <!-- These tests need extra stuff on classpath -->
      <condition property="client.run.classpath" value="security.client.classpath">
         <equals arg1="${test}" arg2="security"/>
      </condition>
      <condition property="client.run.classpath" value="security.client.classpath">
         <equals arg1="${test}" arg2="tck5sec"/>
      </condition>
      <condition property="client.run.classpath" value="dd.web.client.classpath">
         <equals arg1="${test}" arg2="dd/web"/>
      </condition>
      <condition property="client.run.classpath" value="iiop.client.classpath">
         <equals arg1="${test}" arg2="iiop"/>
      </condition>
      <condition property="client.run.classpath" value="full.classpath">
         <or>
            <equals arg1="${test}" arg2="cachepassivation"/>
            <equals arg1="${test}" arg2="threadlocal"/>
         </or>
      </condition>
      <condition property="client.run.classpath" value="client.classpath">
         <not>
            <isset property="client.run.classpath"/>
         </not>
      </condition>

      <condition property="test.jndi.url" value="${node0.jndi.url}">
         <not>
            <isset property="test.jndi.url"/>
         </not>
      </condition>

      <condition property="jboss-junit-configuration" value="${test.extension}">
         <isset property="test.extension"/>         
      </condition>

      <condition property="jboss-junit-configuration" value="">
         <not>  
            <isset property="test.extension"/>         
         </not>  
      </condition>
   	
   	<!-- Use this for debugging classpath 
   	<property name="myclasspath" refid="test.classpath"/>
    <echo message="${myclasspath}" />  -->
   	
      <junit dir="${module.output}"
         printsummary="yes"
         haltonerror="false"
         haltonfailure="false"
         showoutput="yes"
         fork="true">

         <sysproperty key="jbosstest.deploy.dir" value="${build.lib}"/>
         <sysproperty key="build.testlog" value="${build.testlog}"/>
         <sysproperty key="log4j.configuration" value="file:${location.resources.test}/test/log4j.xml"/>
         <sysproperty key="jbosstest.threadcount" value="${jbosstest.threadcount}"/>
         <sysproperty key="jbosstest.iterationcount" value="${jbosstest.iterationcount}"/>
         <sysproperty key="jbosstest.beancount" value="${jbosstest.beancount}"/>
         <sysproperty key="java.security.auth.login.config" value="${resources}/test/security/auth.conf"/>


         <!-- properties needed for clustering -->
         <sysproperty key="jbosstest.cluster.node0" value="${node0}"/>
         <sysproperty key="jbosstest.cluster.node0.http.url" value="${node0.http.url}"/>
         <sysproperty key="jbosstest.cluster.node0.jndi.url" value="${node0.jndi.url}"/>
         <sysproperty key="jbosstest.cluster.node1" value="${node1}"/>
         <sysproperty key="jbosstest.cluster.node1.http.url" value="${node1.http.url}"/>
         <sysproperty key="jbosstest.cluster.node1.jndi.url" value="${node1.jndi.url}"/>
         <sysproperty key="java.naming.provider.url" value="${test.jndi.url}"/>

         <sysproperty key="knownIssuesFile" value="${resources}/known-issues.xml"/>

         <jvmarg line="${jvmargs}" />
         <jvmarg line="-ea" />
         <!--
         <jvmarg line="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=/dt_socket,address=8787,server=y,suspend=y"/>
         -->
      	
         <classpath>
            <pathelement path="${location.target}/jboss-ejb3-testsuite.jar"/>
            
           <path refid="test.classpath" />
           
            <!-- 
            <path refid="hibernate.hibernate.classpath"/> 
            <pathelement location="${build.classes}"/>
            <path refid="${client.run.classpath}"/>
            <pathelement location="${resources}/test"/>
            <path refid="jboss.jbossws.classpath"/>
            <path refid="jboss.jbossws.spi.classpath"/>
            <path refid="apache.xerces.classpath"/>
            <path refid="sun.jaf.classpath"/>
            <path refid="sun.javamail.classpath"/>
            <path refid="apache.httpclient.classpath"/>
            <path refid="jboss.server.classpath"/>
            <path refid="jboss.jbosssx.classpath"/>
	        <path refid="jboss.security.int.classpath"/>
	        <path refid="jboss.jboss.security.spi.classpath"/>
            <path refid="jboss.naming.classpath"/>
            <path refid="trove.classpath"/>
            <path refid="jboss.common.core.classpath"/>
            <path refid="jboss.common.logging.spi.classpath"/>
            <path refid="jboss.common.logging.log4j.classpath"/>
            <path refid="jboss.common.logging.jdk.classpath"/>
         	<path refid="jboss.jboss.ejb3.impl.classpath"/>
            <path refid="jboss.aop.classpath"/>
            <path refid="jboss.aspects.classpath"/>
            <path refid="jboss.jbossxb.classpath"/> -->
         	<!-- for Corba -->
           <!--
            <path refid="jboss.iiop.classpath"/>
         	<path refid="jacorb.jacorb.classpath"/>
         	<path refid="apache.avalon.classpath"/>
         	<path refid="apache.avalon.logkit.classpath"/> -->

            <!-- EJBTHREE-485 needs javassist -->
           <!--
            <path refid="javassist.classpath"/> -->

            <!-- For clustered entities -->
           <!--
            <path refid="hsqldb.hsqldb.classpath"/> -->

            <!-- For JBossWS testing -->
           <!--
            <pathelement path="${sun.jaxb.lib}/jaxb-impl.jar"/>
            <path refid="ibm.wsdl4j.classpath"/> -->
         </classpath>

         <formatter type="plain" usefile="true"/>
         <!-- 
         <formatter type="xml" classname="org.jboss.ejb3.testsuite.ant.taskdefs.optional.junit.KnownIssuesXMLJunitResultFormatter"
            usefile="true" unless="test.extension"/>
            -->
         <formatter type="xml" classname="org.jboss.ejb3.testsuite.Hack"
            usefile="true" unless="test.extension"/>
         <sysproperty key="jboss-junit-configuration" value="${jboss-junit-configuration}"/>  
         <formatter type="xml" classname="org.jboss.ant.taskdefs.XMLJUnitMultipleResultFormatter" 
                    extension="-${test.extension}.xml" usefile="true" if="test.extension"/>

         <batchtest todir="${build.reports}"
            haltonerror="false"
            haltonfailure="false"
            fork="true">

            <fileset dir="${build.classes}">
               <include name="org/jboss/ejb3/test/${test}/unit/*TestCase.class"/>
            </fileset>
         </batchtest>
      </junit>
   </target>

   <target name="one-test" depends="init" if="test"
      description="Execute one test Junit test case.">
      <!-- For use when we do not need to pass in any special jvmargs; forks the test process -->
      <antcall target="one-test-with-jvmargs" inheritRefs="true">
         <param name="test" value="${test}"/>
         <param name="jvmargs" value=""/>
      </antcall>
   </target>

   <!-- Single unit test -->
   <target name="one-test-with-jvmargs" if="test">
      <!-- For use when we need to pass in special jvmargs -->
      
      
      <mkdir dir="${build.reports}"/>
      <mkdir dir="${build.testlog}"/>
      <!-- Remove the test.log so each run has a fresh log -->
      <delete file="${build.testlog}/test.log"/>

     <!-- These tests need extra stuff on classpath -->
      <condition property="client.run.classpath" value="client.classpath">
         <not>
            <isset property="client.run.classpath"/>
         </not>
      </condition>

      <!-- Ensure JBOSS_HOME is set -->
      <fail unless="env.JBOSS_HOME" message="Environment Variable $JBOSS_HOME must be Set" />

      <junit dir="${module.output}"
         printsummary="yes"
         haltonerror="false"
         haltonfailure="false"
         showoutput="yes"
         fork="true">

         <sysproperty key="jbosstest.deploy.dir" value="${build.lib}"/>
         <sysproperty key="build.testlog" value="${build.testlog}"/>
         <sysproperty key="log4j.configuration" value="file:${location.resources.test}/test/log4j.xml"/>
         <sysproperty key="jbosstest.threadcount" value="${jbosstest.threadcount}"/>
         <sysproperty key="jbosstest.iterationcount" value="${jbosstest.iterationcount}"/>
         <sysproperty key="jbosstest.beancount" value="${jbosstest.beancount}"/>
         <sysproperty key="java.security.auth.login.config" value="${resources}/test/security/auth.conf"/>


         <!-- properties needed for clustering -->
         <sysproperty key="jbosstest.cluster.node0" value="${node0}"/>
         <sysproperty key="jbosstest.cluster.node0.http.url" value="${node0.http.url}"/>
         <sysproperty key="jbosstest.cluster.node0.jndi.url" value="${node0.jndi.url}"/>
         <sysproperty key="jbosstest.cluster.node1" value="${node1}"/>
         <sysproperty key="jbosstest.cluster.node1.http.url" value="${node1.http.url}"/>
         <sysproperty key="jbosstest.cluster.node1.jndi.url" value="${node1.jndi.url}"/>
         <sysproperty key="java.naming.provider.url" value="${node0.jndi.url}"/>

         <jvmarg line="${jvmargs}" />
         <!-- <jvmarg line="${jvmargs} -Xrunjdwp:transport=dt_socket,address=8788,server=y,suspend=y" /> -->
         <classpath>
           
           <path refid="test.classpath" />
           <pathelement location="${build.classes}"/>
           
           <!--
            <path refid="hibernate.hibernate.classpath"/>
            <pathelement location="${build.classes}"/>
            <path refid="${client.run.classpath}"/>
            <pathelement location="${resources}/test"/>
            <path refid="jboss.jbossws.classpath"/>
            <path refid="jboss.jbossws.spi.classpath"/>
            <path refid="apache.xerces.classpath"/>
            <path refid="sun.jaf.classpath"/>
            <path refid="sun.javamail.classpath"/>
            <path refid="apache.httpclient.classpath"/>
            <path refid="jboss.server.classpath"/>
            <path refid="jboss.jbosssx.classpath"/>
	        <path refid="jboss.security.int.classpath"/>
	        <path refid="jboss.jboss.security.spi.classpath"/>
            <path refid="jboss.naming.classpath"/>
            <path refid="trove.classpath"/>
            <path refid="jboss.common.core.classpath"/>
            <path refid="jboss.common.logging.spi.classpath"/>
            <path refid="jboss.common.logging.log4j.classpath"/>
            <path refid="jboss.common.logging.jdk.classpath"/>
            <path refid="jboss.aop.classpath"/>
            <path refid="jboss.aspects.classpath"/>
            <path refid="jboss.jbossxb.classpath"/>
         	 for Corba 
            <path refid="jboss.iiop.classpath"/>
         	<path refid="jacorb.jacorb.classpath"/>
         	<path refid="apache.avalon.classpath"/>
         	<path refid="apache.avalon.logkit.classpath"/>

             EJBTHREE-485 needs javassist
            <path refid="javassist.classpath"/>

             For clustered entities 
            <path refid="hsqldb.hsqldb.classpath"/> -->
         </classpath>

         <formatter type="plain" usefile="true"/>
         <formatter type="xml" usefile="true"/>
         <test name="${test}" todir="${build.reports}"/>
      </junit>
   </target>

   <target name="client14-tests" depends="init"
      description="Execute all tests for Java1.4 client compatibility.">
      <mkdir dir="${build.reports}"/>
      <mkdir dir="${build.testlog}"/>

      <junit dir="${module.output}"
         printsummary="yes"
         haltonerror="false"
         haltonfailure="false"
         jvm="java"
         fork="true">

         <sysproperty key="jbosstest.deploy.dir" value="${build.lib}"/>
         <sysproperty key="build.testlog" value="${build.testlog}"/>
         <sysproperty key="log4j.configuration" value="file:${location.resources.test}/test/log4j.xml"/>
         <sysproperty key="jbosstest.threadcount" value="${jbosstest.threadcount}"/>
         <sysproperty key="jbosstest.iterationcount" value="${jbosstest.iterationcount}"/>
         <sysproperty key="jbosstest.beancount" value="${jbosstest.beancount}"/>

         <classpath>
            <pathelement location="${build.classes}"/>
            <pathelement location="${resources}/test"/>
            <path refid="jboss.test.classpath"/>
            <path refid="client.classpath"/>
         </classpath>

         <formatter type="plain" usefile="true"/>
         <formatter type="xml" usefile="true"/>

         <batchtest todir="${build.reports}"
            haltonerror="false"
            haltonfailure="false"
            fork="true">

            <fileset dir="${build.classes}">
               <include name="org/jboss/ejb3/test/stateless14/unit/*TestCase.class"/>
            </fileset>
         </batchtest>
      </junit>
   </target>

   <target name="embedded-test" depends="init" if="test"
      description="Execute all tests in the given test directory.">
      <mkdir dir="${build.reports}"/>
      <mkdir dir="${build.testlog}"/>
      <!-- Remove the test.log so each run has a fresh log -->
      <delete file="${build.testlog}/test.log"/>
      <path id="test.classpath">
         <pathelement location="${build.classes}"/>
         <pathelement location="${resources}/test/${test}"/>
         <path refid="junit.junit.classpath"/>
         <path refid="jboss.test.classpath"/>
         <path refid="jboss.embedded.classpath"/>
      </path>
      <junit dir="${module.output}"
         printsummary="yes"
         haltonerror="false"
         haltonfailure="false"
         fork="true">

         <sysproperty key="jbosstest.deploy.dir" value="${build.lib}"/>
         <sysproperty key="build.testlog" value="${build.testlog}"/>
         <sysproperty key="jbosstest.threadcount" value="${jbosstest.threadcount}"/>
         <sysproperty key="jbosstest.iterationcount" value="${jbosstest.iterationcount}"/>
         <sysproperty key="jbosstest.beancount" value="${jbosstest.beancount}"/>

         <classpath>
            <path refid="test.classpath"/>
         </classpath>

         <formatter type="plain" usefile="true"/>
         <formatter type="xml" usefile="true"/>

         <batchtest todir="${build.reports}"
            haltonerror="false"
            haltonfailure="false"
            fork="true">

            <fileset dir="${build.classes}">
               <include name="org/jboss/ejb3/test/${test}/unit/*EmbeddedTest.class"/>
            </fileset>
         </batchtest>
      </junit>
   </target>


   <target name="run-clusteredentity" depends="init"
      description="Runs the clusteredentity stuff in a cluster">

      <!-- clusteredentity-test.ejb3 file needs to be deployed manually-->

      <!-- IP:port of the two nodes in the cluster -->
      <property name="naming1" value="192.168.1.1:1099"/>
      <property name="naming1" value="192.168.1.2:1099"/>

      <java fork="yes" className="org.jboss.ejb3.test.clusteredentity.unit.CachedEntityRun">
         <arg value="${naming1}"/>
         <arg value="${naming2}"/>
         <classpath>
            <pathelement location="${build.classes}"/>
            <pathelement location="${resources}/test"/>
            <path refid="javac.classpath"/>
         </classpath>
      </java>
   </target>



   <target name="run" depends="init" if="class"
      description="Execute all tests in the given test directory.">
      <java fork="true" classname="${class}">
         <jvmarg value="-Dorg.jboss.jms.asf.useold=true"/>
         <classpath>
            <pathelement location="${build.classes}"/>
            <pathelement location="${resources}/test"/>
            <path refid="javac.classpath"/>
         </classpath>
      </java>
   </target>

   <target name="tests" depends="init" description="Execute all tests">
      <antcall target="simple-tests" inheritRefs="true"/>
      <antcall target="ejb-tests" inheritRefs="true"/>
      <antcall target="entity-tests" inheritRefs="true"/>
      <antcall target="ssl-simple-test"  inheritRefs="true"/>
      <antcall target="ssl-advanced-test"  inheritRefs="true"/>
      <antcall target="jacc-test" inheritRefs="true"/>
      <antcall target="clustered-tests" inheritRefs="true"/>
	  <antcall target="clustered-jms-test" inheritRefs="true"/>
      <antcall target="invoker-test"  inheritRefs="true"/>
      <antcall target="iiop-tests"  inheritRefs="true"/>
      <antcall target="libdeployment-test"  inheritRefs="true"/>
	  <!--antcall target="multi-instance-localfromremote-test"  inheritRefs="true"/-->
	  <antcall target="statelesscreation-test"  inheritRefs="true"/>
	  <antcall target="removedislocal-test"  inheritRefs="true"/>
	  <antcall target="statefulproxyfactoryoverride-test"  inheritRefs="true"/>
   </target>

   <target name="no-start-jboss-tests" depends="init" description="Execute all tests">
      <antcall target="no-start-jboss-ejb-tests" inheritRefs="true"/>
      <antcall target="no-start-jboss-entity-tests" inheritRefs="true"/>
      <antcall target="no-start-jboss-iiop-tests" inheritRefs="true"/>
   </target>

   <target name="simple-tests" depends="init">
      <antcall target="test" inheritRefs="true">
         <param name="test" value="cachepassivation"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="threadlocal"/>
      </antcall>
   </target>
   
   <target name="ejb-tests" depends="init" description="Execute all tests">
      <server:start name="all"/>
      <antcall target="no-start-jboss-ejb-tests" inheritRefs="true"/>
      <server:stop name="all"/>
   </target>

   <target name="start-stop-test" depends="init" description="Start and stop JBoss">

      <start-jboss conf="all" host="${node0}" jvmargs="${ejb3.jboss.jvmargs}"/>
      <wait-on-host/>

      <stop-jboss/>
      <wait-on-shutdown conf="all"/>
   </target>

   <target name="no-start-jboss-ejb-tests" depends="init" description="Execute all tests">
	  <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1090"/>
      </antcall>
	  <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1092"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="webservices"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/ejbthree454"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/ejbthree670"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/salesforce7123"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/scopedclassloader"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="dependency"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="bmt"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="appclient"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/ejbthree249"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/ejbthree316"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/ejbthree231"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="clientinterceptors"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="interceptors2"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="interceptors3"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="interceptors"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="jaxws"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="txexceptions"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="localcall"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="service"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="stateful"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="descriptortypo"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="concurrent"/>
      </antcall>
      <!--antcall target="test" inheritRefs="true">
         <param name="test" value="seam"/>
      </antcall-->
      <antcall target="test" inheritRefs="true">
         <param name="test" value="aspectdomain"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbcontext"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="initial"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="timer"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="timerdependency"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="classloader"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="arjuna"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="asynchronous"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="mdb"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="invalidtxmdb"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="mdbtransactions"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="consumer"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="cache"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="strictpool"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="singleton"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="stateless"/>
      </antcall>
	  <antcall target="test" inheritRefs="true">
         <param name="test" value="defaultremotebindings"/>
      </antcall>
	  <antcall target="test" inheritRefs="true">
	      <param name="test" value="concurrentnaming"/>
	  </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="homeinterface"/>
      </antcall>
	  <antcall target="test" inheritRefs="true">
		 <param name="test" value="propertyreplacement"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="deployer"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="container"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="circulardependency"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="servicedependency"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="security"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="bank"/>
      </antcall>
      <!--antcall target="test" inheritRefs="true">
         <param name="test" value="transaction"/>
      </antcall-->
      <antcall target="test" inheritRefs="true">
         <param name="test" value="schema"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="mail"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="unauthenticatedprincipal"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="securitydomain"/>
      </antcall>
	  <antcall target="test" inheritRefs="true">
	     <param name="test" value="security5"/>
	  </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="tck5sec"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="naming"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="pool"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="reference21_30"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="dd/mdb"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="jca/inflowmdb"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="jms"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="jms/managed"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="enventry"/>
      </antcall>
      <!--antcall target="test" inheritRefs="true">
         <param name="test" value="jca"/>
      </antcall-->
      <antcall target="test" inheritRefs="true">
         <param name="test" value="dd/override"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="dd/web"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="jsp"/>
      </antcall>
      <!--antcall target="test" inheritRefs="true">
         <param name="test" value="loginmodule"/>
      </antcall-->
      <antcall target="test" inheritRefs="true">
         <param name="test" value="exception"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="microbench"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree471"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree712"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree724"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree751"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree785"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree786"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree832"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree936"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree939"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree953"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree957"/>
      </antcall>
   	  <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree959"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree963"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree967"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree971"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree973"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree985"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree986"/>
      </antcall>
	  <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree987"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree994"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree989"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1020"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1023"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1025"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1028"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1040"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1057"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1059"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1060"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1062"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1066"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1071"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1075"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1082"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1116"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1119"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1122"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1123"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1127"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1130"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1146"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1148"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1154"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1157"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1222"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
        <param name="test" value="ejbthree1271"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1339"/>
      </antcall>
   	  <antcall target="test" inheritRefs="true">
   	     <param name="test" value="ejbthree1530"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1624"/>
      </antcall>
   	  <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1647"/>
   	  </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="statelesscreation"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="jbas4489"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="changexml"/>
      </antcall>
   </target>

   <target name="entity-tests" depends="init" description="Execute all tests">

      <server:start name="all"/>

      <antcall target="no-start-jboss-entity-tests" inheritRefs="true"/>

      <server:stop name="all"/>
   </target>

   <target name="no-start-jboss-entity-tests" depends="init" description="Execute all tests">
	  <antcall target="test" inheritRefs="true">
         <param name="test" value="epcpropagation"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/ejbthree440"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regression/ejbthree290"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="longlived"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="factory"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="ear"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="factoryxml"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="hbm"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="pkg"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="entityexception"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="secondary"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="xmlcfg"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="lob"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="composite"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="composite2"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="entity"/>
      </antcall>
	  <antcall target="test" inheritRefs="true">
         <param name="test" value="entityoptimisticlocking"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="persistenceunits"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="manytomany"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="joininheritance"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="singletableinheritance"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="tableperinheritance"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="dependent"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="entitycallback"/>
      </antcall>
      <antcall target="test" inheritRefs="true">
         <param name="test" value="regressionHHH275"/>
      </antcall>

   </target>

   <target name="clustered-test" depends="init">
     
     <create-cluster-node conf="clustered-ejb3-totalrep-0"/>
     <create-cluster-node conf="clustered-ejb3-totalrep-1"/>
      
     <!-- For now use REPL_SYNC -->
     <cache-mode-config-change conf="clustered-ejb3-totalrep-0"/>
     <cache-mode-config-change conf="clustered-ejb3-totalrep-1"/>
          
     <server:start name="clustered-ejb3-totalrep-0" />
     <server:start name="clustered-ejb3-totalrep-1" />

      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="jvmargs" value=""/>
         <!--
         <param name="jvmargs"
                value="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=/dt_socket,address=8787,server=n,suspend=n"/>
         -->
      </antcall>

      <server:stop name="clustered-ejb3-totalrep-0"/>
      <server:stop name="clustered-ejb3-totalrep-1"/>
       
   </target>

   <target name="clustered-one-test" depends="init, clusteredsession, clusteredentity">

     <create-cluster-node conf="clustered-ejb3-totalrep-0"/>
     <create-cluster-node conf="clustered-ejb3-totalrep-1"/>
      
     <!-- For now use REPL_SYNC -->
     <cache-mode-config-change conf="clustered-ejb3-totalrep-0"/>
     <cache-mode-config-change conf="clustered-ejb3-totalrep-1"/>
          
     <server:start name="clustered-ejb3-totalrep-0" />
     <server:start name="clustered-ejb3-totalrep-1" />

      <antcall target="one-test-with-jvmargs" inheritRefs="true">
         <!--param name="test" value="clusteredsession"/-->
         <param name="jvmargs" value=""/>
         <!--
         <param name="jvmargs"
                value="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=/dt_socket,address=8787,server=n,suspend=n"/>
         -->
      </antcall>
       <server:stop name="clustered-ejb3-totalrep-0"/>
       <server:stop name="clustered-ejb3-totalrep-1"/>

   </target>

   <target name="clustered-tests" depends="init, clusteredsession, clusteredentity, ejbthree921">
     
     <create-cluster-node conf="clustered-ejb3-totalrep-0"/>
     <create-cluster-node conf="clustered-ejb3-totalrep-1"/>
     	
     <!-- For now use REPL_SYNC -->
     <cache-mode-config-change conf="clustered-ejb3-totalrep-0"/>
     <cache-mode-config-change conf="clustered-ejb3-totalrep-1"/>
          
     <server:start name="clustered-ejb3-totalrep-0" />
     <server:start name="clustered-ejb3-totalrep-1" />

     <antcall target="test-clustered-entity"/>
     <antcall target="test-cluster-session"/>
      
     <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="ejbthree1346"/>
         <param name="jvmargs" value=""/>
         <param name="test.extension" value="BR-disabled"/> 
     </antcall>
      
     <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="ejbthree1053"/>
         <param name="jvmargs" value=""/>
     	   <!-- Not "test-extension" param or ingnoring the known-issue won't work -->
     </antcall>

     <server:stop name="clustered-ejb3-totalrep-0"/>
     <server:stop name="clustered-ejb3-totalrep-1"/>
   
     <!-- Rerun the tests with buddy replication turned on -->  
     <antcall target="clustered-buddyrepl-test"/>

   </target>

   <target name="libdeployment-test" depends="init">
      <create-config baseconf="all" newconf="libdeployment">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy*/**"/>
            <include name="lib/**"/>
         </patternset>
      </create-config>

      <server:start name="libdeployment" />

      <antcall target="test" inheritRefs="true">
         <param name="test" value="libdeployment"/>
      </antcall>

      <server:stop name="libdeployment" />
   </target>
	
   <target name="statefulproxyfactoryoverride-test" depends="init">
      <create-config baseconf="all" newconf="statefulproxyfactoryoverride">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy*/**"/>
            <include name="lib/**"/>
	        <include name="deployers/**"/>
         </patternset>
      </create-config>

      <server:start name="statefulproxyfactoryoverride" />

      <antcall target="test" inheritRefs="true">
         <param name="test" value="statefulproxyfactoryoverride"/>
      </antcall>

      <server:stop name="statefulproxyfactoryoverride" />
   </target>
  
   <target name="ejbthree1504-test" depends="init">
      <delete dir="${jboss.dist}/server/ejbthree1504" failonerror="false"/>
     
      <create-config baseconf="all" newconf="ejbthree1504">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy*/**"/>
            <include name="lib/**"/>
          <include name="deployers/**"/>
         </patternset>
      </create-config>
          
      <server:start name="ejbthree1504"/>

      <antcall target="test" inheritRefs="true">
         <param name="test" value="ejbthree1504"/>
      </antcall>

      <server:stop name="ejbthree1504" />
   </target>

   <target name="ssl-simple-test" depends="init">
     <create-config baseconf="all" newconf="ejb3-ssl">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy*/**"/>
            <include name="lib/**"/>
         </patternset>
      </create-config>
     
     <server:start name="ejb3-ssl"/>

      <!-- Tell client to use the supplied truststore -->
      <property name="jvmargs" value="-Djavax.net.ssl.trustStore=${resources}/test/ssl/localhost.truststore -Djavax.net.ssl.trustStorePassword=opensource"/>

      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="ssl"/>
         <param name="jvmargs" value="${jvmargs}"/>
      </antcall>

      <server:stop name="ejb3-ssl"/>
   </target>

   <target name="ssl-advanced-test" depends="init">
     <create-config baseconf="all" newconf="ejb3-ssl-advanced">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy*/**"/>
            <include name="lib/**"/>
         </patternset>
      </create-config>
     
     <server:start name="ejb3-ssl-advanced"/>

      <!-- Tell client to use the supplied truststore -->
      <property name="jvmargs" value="-Djavax.net.ssl.trustStore=${resources}/test/ssl/localhost.truststore -Djavax.net.ssl.trustStorePassword=opensource"/>

      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="ssladvanced"/>
         <param name="jvmargs" value="${jvmargs}"/>
      </antcall>

     <server:stop name="ejb3-ssl-advanced"/>
   </target>

   <target name="invoker-test" depends="init">
      <create-config baseconf="all" newconf="invoker">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy*/**"/>
            <include name="lib/**"/>
         </patternset>
      </create-config>
     
      <server:start name="invoker" />

      <property name="jvmargs" value=""/>

      <antcall target="test" inheritRefs="true">
         <param name="test" value="invoker"/>
      </antcall>

      <server:stop name="invoker" />
   </target>

   <target name="jacc-test" depends="init">
      <create-config baseconf="all" newconf="ejb3-jacc">
         <patternset>
            <include name="conf/**"/>
            <include name="deploy*/**"/>
            <include name="lib/**"/>
         </patternset>
      </create-config>
     
      <server:start name="ejb3-jacc"/>
     
      <antcall target="test" inheritRefs="true">
         <param name="test" value="jacc"/>
      </antcall>
      
      <server:stop name="ejb3-jacc"/>
   </target>

   <!-- ================================================================== -->
   <!-- Clustering                                                         -->
   <!-- ================================================================== -->

   <!-- Stuff needed for clustering -->

   <target name="test-clustered-entity">
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="clusteredentity"/>
         <param name="jvmargs" value=""/>
      </antcall>

   </target>

   <target name="test-cluster-session">
         
      <property name="buddy-replication-extension" value="BR-disabled"/> 
   
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="clusteredsession"/>
         <param name="jvmargs" value=""/>
         <param name="test.extension" value="${buddy-replication-extension}"/> 
         <!--
         <param name="jvmargs"
                value="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=8787,server=n,suspend=n"/>
         -->
      </antcall>
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="ejbthree921"/>
         <param name="jvmargs" value=""/>
         <param name="test.extension" value="${buddy-replication-extension}"/> 
      </antcall>
	
	  <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="ejbthree1136"/>
         <param name="jvmargs" value=""/>
         <param name="test.extension" value="${buddy-replication-extension}"/> 
      </antcall>
   </target>
	
   <target name="statelesscreation-test">
      <create-config baseconf="all" newconf="statelesscreation">
         <patternset>
	        <include name="conf/**"/>
	        <include name="deploy*/**"/>
	        <include name="lib/**"/>
         </patternset>
      </create-config>
       
      <server:start name="statelesscreation" />
	
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="statelesscreation"/>
         <param name="jvmargs" value=""/>
      </antcall>
      
      <server:stop name="statelesscreation" />
   </target>
	
   <target name="removedislocal-test">
      <create-config baseconf="all" newconf="removedislocal">
         <patternset>
	        <include name="conf/**"/>
	        <include name="deploy*/**"/>
	        <include name="lib/**"/>
         </patternset>
      </create-config>
       
      <server:start name="removedislocal" />
	
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="removedislocal"/>
         <param name="jvmargs" value=""/>
      </antcall>
      
      <server:stop name="removedislocal" />
   </target>

   <target name="multi-instance-localfromremote-test">
      <create-config baseconf="default" newconf="localfromremote1">
         <patternset>
	        <include name="conf/**"/>
	        <include name="deploy*/**"/>
	        <include name="lib/**"/>
         </patternset>
      </create-config>
      <create-config baseconf="default" newconf="localfromremote2">
         <patternset>
	        <include name="conf/**"/>
	        <include name="deploy*/**"/>
	        <include name="lib/**"/>
         </patternset>
      </create-config>
     
     <server:start name="localfromremote1" />
     <server:start name="localfromremote2" />

	   <antcall target="tests-multi-instance-wait"/>

	   <antcall target="test-with-jvmargs" inheritRefs="true">
       <param name="test" value="localfromremote"/>
       <param name="jvmargs" value=""/>
     </antcall>

     <server:stop name="localfromremote1" />
     <server:stop name="localfromremote2" />

   </target>

   <target name="clustered-jms-test">
      <create-config baseconf="all" newconf="clusteredjms">
         <patternset>
	        <include name="conf/**"/>
	        <include name="deploy*/**"/>
	        <include name="lib/**"/>
         </patternset>
      </create-config>
      <create-config baseconf="all" newconf="clusteredjms2">
         <patternset>
	        <include name="conf/**"/>
	        <include name="deploy*/**"/>
	        <include name="lib/**"/>
            <exclude name="deploy/mdbtest-service.xml"/>
         </patternset>
      </create-config>
     
      <server:start name="clusteredjms" />
      <server:start name="clusteredjms2" />

	  <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="clusteredjms"/>
         <param name="jvmargs" value=""/>
      </antcall>

     <server:stop name="clusteredjms" />
     <server:stop name="clusteredjms2" />
   </target>

   <!-- A macro for converting a cache to REPL_SYNC from REPL_ASYNC -->
   <macrodef name="cache-mode-config-change">
      <attribute name="conf"/>
      <attribute name="cacheMode" default="REPL_SYNC"/>
      <sequential>
         <echo message="Setting CacheMode to ${cacheMode} in ${jboss.dist}/server/@{conf}"/>
         <!-- If we're using a sar -->
         <replaceregexp flags="g"
            file="${jboss.dist}/server/@{conf}/deploy/cluster/jboss-cache-manager.sar/META-INF/jboss-cache-configs.xml"
         	match="&lt;attribute name=&quot;CacheMode&quot;&gt;REPL_ASYNC" 
         	replace="&lt;attribute name=&quot;CacheMode&quot;&gt;@{cacheMode}"/>
         <!-- If we're using a plain beans.xml -->
         <replaceregexp flags="g"
            file="${jboss.dist}/server/@{conf}/deploy/cluster/jboss-cache-manager-beans.xml"
         	match="&lt;property name=&quot;cacheMode&quot;&gt;REPL_ASYNC" 
         	replace="&lt;property name=&quot;cacheMode&quot;&gt;@{cacheMode}"/>        
      </sequential>
   </macrodef>

   <!-- A macro for turning on buddy replication in a node -->
   <macrodef name="buddy-repl-config-change">
      <attribute name="conf"/>
      <attribute name="useBuddyRepl" default="true"/>
      <sequential>
         <echo message="Enabling EJB3 SFSB buddy replication in ${jboss.dist}/server/@{conf}"/>
         <!-- If we're using a sar -->
         <replaceregexp flags="g"
         	file="${jboss.dist}/server/@{conf}/deploy/cluster/jboss-cache-manager.sar/META-INF/jboss-cache-configs.xml"
            match="&lt;buddyReplicationEnabled&gt;false" 
         	replace="&lt;buddyReplicationEnabled&gt;@{useBuddyRepl}"/>
         <!-- If we're using a plain beans.xml -->
         <replaceregexp flags="g"
         	file="${jboss.dist}/server/@{conf}/deploy/cluster/jboss-cache-manager-beans.xml"
            match="&lt;property name=&quot;enabled&quot;&gt;false" 
         	replace="&lt;property name=&quot;enabled&quot;&gt;@{useBuddyRepl}"/>         
      </sequential>
   </macrodef>

   <target name="clustered-buddyrepl-test">
     
      <create-cluster-node conf="clustered-ejb3-BR-0"/>
      <create-cluster-node conf="clustered-ejb3-BR-1"/>

      <buddy-repl-config-change conf="clustered-ejb3-BR-0"/>
      <buddy-repl-config-change conf="clustered-ejb3-BR-1"/>
     
      <server:start name="clustered-ejb3-BR-0" />
      <server:start name="clustered-ejb3-BR-1" />

      <antcall target="test-cluster-session" inheritRefs="true">
         <param name="buddy-replication-extension" value="BR-enabled"/>
      </antcall>

     <server:stop name="clustered-ejb3-BR-0" />
     <server:stop name="clustered-ejb3-BR-1" />

   </target>

   <target name="tests-multi-instance-wait" unless="${tests.clustering.skip.startup}">
      <echo message="Waiting for nodes to start..."/>
      <waitfor maxwait="120" maxwaitunit="second"
         checkevery="5" checkeveryunit="second" timeoutproperty="cluster.timeout">
         <and>
            <http url="${node0.http.url}"/>
            <http url="${node0.http.port1.url}"/>
         </and>
      </waitfor>
      <fail message="Timeout waiting for nodes to start" if="cluster.timeout"/>
      <echo message="Nodes have started, waiting for cluster to stablize..."/>
   </target>

   <!-- ================================================================== -->
   <!-- Cleaning                                                           -->
   <!-- ================================================================== -->

   <!-- Clean up all build output -->
   <target name="clean"
      description="Cleans up most generated files." depends="init">
      <delete dir="${build.classes}/org/jboss/test"/>
      <delete dir="${build.classes}/org/jboss/ejb3/test"/>
   </target>

   <!-- ================================================================== -->
   <!-- Misc.                                                              -->
   <!-- ================================================================== -->

   <target name="main"
      description="Executes the default target (most)."
      depends="jars"/>


   <target name="tests-report-html" depends="compile-stylesheets">
      <mkdir dir="${build.reports}/html"/>

      <junitreport todir="${build.reports}">
         <fileset dir="${build.reports}">
            <include name="TEST-*.xml"/>
         </fileset>
         <report format="frames"
            todir="${build.reports}/html"
            styledir="${build.stylesheets}"
            />
      </junitreport>
   </target>

  <target name="tests-report-text" depends="tests-report-html">
    <mkdir dir="${build.reports}/text"/>

    <style basedir="${build.reports}"
      destdir="${build.reports}/text"
      extension=".txt"
      style="${build.stylesheets}/summary1b.xsl"
      includes="TESTS-TestSuites.xml">
      <param name="thedate" expression="${TIMENOW}"/>
      <param name="java_version" expression="${java.version}"/>
      <param name="java_vendor" expression="${java.vendor}"/>
      <param name="java_vm_specification_version" expression="${java.vm.specification.version}"/>
      <param name="java_vm_version" expression="${java.vm.version}"/>
      <param name="java_vm_name" expression="${java.vm.name}"/>
      <param name="java_vm_info" expression="${java.vm.info}"/>
      <param name="java_specification_version" expression="${java.specification.version}"/>
      <param name="java_class_version" expression="${java.class.version}"/>
      <param name="os_name" expression="${os.name}"/>
      <param name="os_arch" expression="${os.arch}"/>
      <param name="os_version" expression="${os.version}"/>
      <param name="builduid" expression="${TIMENOW}"/>
      <param name="results_web" expression="${results_web}"/>
    </style>
  </target>


   <target name="tests-report-clean">
      <delete dir="${build.reports}"/>
   </target>

   <target name="jacorb-test" depends="init" if="test"
      description="Execute all tests in the given test directory using JacORB.">
      <!--property name="debugFlags" value="-Xdebug -Xrunjdwp:transport=dt_socket,address=8888,server=y,suspend=y"/-->
      <property name="debugFlags" value=""/>
      <!-- For use when we do not need to pass in any special jvmargs; forks the test process -->
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="${test}"/>
         <param name="test.extension" value="jacorb"/>
         <param name="test.jndi.url" value="corbaloc::localhost:3528/JBoss/Naming/root"/>
      	 <!-- using jacorb -->
         <param name="jvmargs" value="${debugFlags}
            -Djava.security.manager
            -Djava.security.policy=${resources}/security/tst.policy
            -Dorg.omg.CORBA.ORBClass=org.jacorb.orb.ORB
            -Dorg.omg.CORBA.ORBSingletonClass=org.jacorb.orb.ORBSingleton
            -Dorg.omg.PortableInterceptor.ORBInitializerClass.org.jboss.tm.iiop.TxClientInterceptorInitializer
            -Dorg.omg.PortableInterceptor.ORBInitializerClass.org.jboss.iiop.csiv2.SASClientInitializer
            -DORBInitRef.NameService=corbaloc::localhost:3528/JBoss/Naming/root
            -Djacorb.log.default.verbosity=10
            -Djacorb.log.loggerFactory=org.jboss.util.Log4jLoggerFactory" />
      </antcall>
   </target>

   <target name="sunorb-test" depends="init" if="test"
      description="Execute all tests in the given test directory using Sun ORB.">
      <!--property name="debugFlags" value="-Xdebug -Xrunjdwp:transport=dt_socket,address=8888,server=y,suspend=y"/-->
      <property name="debugFlags" value=""/>
      <!-- For use when we do not need to pass in any special jvmargs; forks the test process -->
      <antcall target="test-with-jvmargs" inheritRefs="true">
         <param name="test" value="${test}"/>
         <param name="test.extension" value="sunorb"/>
         <!-- using sun jdk -->
         <param name="jvmargs" value="-Djava.security.manager -Djava.security.policy=${resources}/security/tst.policy -Dorg.omg.PortableInterceptor.ORBInitializerClass.org.jboss.tm.iiop.TxClientInterceptorInitializer -Dorg.omg.CORBA.ORBInitRef.NameService=corbaloc::localhost:3528/JBoss/Naming/root"/>
      </antcall>
   </target>

   <target name="iiop-tests" depends="init" description="Execute all tests">

      <server:start name="all" />

      <antcall target="no-start-jboss-iiop-tests" inheritRefs="true"/>

      <server:stop name="all" />
   </target>

   <target name="no-start-jboss-iiop-tests" depends="init" description="Execute all iiop tests">
      <antcall target="jacorb-test" inheritRefs="true">
         <param name="test" value="iiop"/>
      </antcall>
      <!-- TODO: call sunorb-test, but the report gets overwritten -->
   </target>

   <target name="stop-jboss">
      <server:stop name="all"/>
   </target>
</project>
