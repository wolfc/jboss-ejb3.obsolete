<?xml version="1.0" encoding="UTF-8"?>
<deployment xmlns="urn:jboss:bean-deployer:2.0">
   <bean name="SimpleClassLoaderDeployer" class="org.jboss.ejb3.test.tx.common.SimpleClassLoaderDeployer"/>
   
   <bean name="AspectManager" class="org.jboss.aop.AspectManager">
      <constructor factoryClass="org.jboss.aop.AspectManager" factoryMethod="instance"/>
   </bean>
   
   <bean name="AspectAppParsingDeployer" class="org.jboss.aop.deployers.AspectAppParsingDeployer"/>
   <bean name="AspectDeployer" class="org.jboss.aop.deployers.AspectDeployer">
      <property name="type">aop</property>
      <property name="aspectManager"><inject bean="AspectManager"/></property>
   </bean>
    
   <!-- The MainDeployer -->
   <bean name="MainDeployer" class="org.jboss.deployers.plugins.main.MainDeployerImpl">
      <property name="structuralDeployers"><inject bean="StructuralDeployers"/></property>
      <property name="deployers"><inject bean="Deployers"/></property>
      <!--property name="mgtDeploymentCreator"><inject bean="ManagedDeploymentCreator"/></property-->
   </bean>
      
   <!-- The holder for deployers that determine structure -->
   <bean name="StructuralDeployers" class="org.jboss.deployers.vfs.plugins.structure.VFSStructuralDeployersImpl">
      <property name="structureBuilder">
         <!-- The consolidator of the structure information -->
         <bean name="StructureBuilder" class="org.jboss.deployers.vfs.plugins.structure.VFSStructureBuilder"/>
      </property>
      <!-- Accept any implementor of structure deployer -->
      <incallback method="addDeployer"/>
      <uncallback method="removeDeployer"/>
   </bean>
   
   <!-- The holder for deployers that do real deployment -->
   <bean name="Deployers" class="org.jboss.deployers.plugins.deployers.DeployersImpl">
      <constructor><parameter><inject bean="jboss.kernel:service=KernelController"/></parameter></constructor>
      <!-- Accept any implementor of deployer -->
      <incallback method="addDeployer"/>
      <uncallback method="removeDeployer"/>
   </bean>
   
   <!-- File Structure -->
   <bean name="FileStructure" class="org.jboss.deployers.vfs.plugins.structure.file.FileStructure"/>
   
   <!-- JNDI -->
   <bean name="NameServer" class="org.jnp.server.SingletonNamingServer"/>
   
   <bean name="TransactionManager" class="org.jboss.ejb3.test.tx.common.SimpleTransactionService">
      <depends>NameServer</depends>
   </bean>
   
   <bean name="AspectDeployment" class="org.jboss.ejb3.test.tx.common.AspectDeployment">
      <property name="mainDeployer"><inject bean="MainDeployer"/></property>
      <property name="resource">instance/jboss-aop.xml</property>
      <depends>TransactionManager</depends>
   </bean>
   
   <bean name="TestContainer" class="org.jboss.ejb3.test.tx.common.SimpleContainer">
      <constructor>
         <parameter>TestContainer</parameter>
         <parameter>Stateful Container</parameter>
         <parameter>org.jboss.ejb3.test.tx.instance.InstanceTestBean</parameter>
      </constructor>
      <depends>AspectDeployment</depends>
      <depends>TransactionManager</depends>
   </bean>
</deployment>