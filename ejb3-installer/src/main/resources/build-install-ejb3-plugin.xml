<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id: build-install-ejb3-plugin.xml 68707 2008-01-09 00:20:17Z andrew.rubinger@jboss.org $ -->

<project name="jboss-ejb3-plugin-installer" default="install" basedir=".">

  <!-- Project Properties ============================================================== -->

  <!-- Environment -->
  <property environment="env" />
  <property name="jboss.home" value="${env.JBOSS_HOME}" />
  <property name="installer.home" value="${env.JBOSS_EJB3_PLUGIN_INSTALL_HOME}" />
  
  <!-- Configuration -->
  <property name="installer.lib" value="${installer.home}/lib" />

  <!-- Includes file of patterns to remove from existing AS Installation -->
  <property name="file.jbossas.remove.includes" value="conf/jbossas-ejb3-files-to-remove.txt" />
  <property name="file.jbossas.serverlib.includes" value="conf/jbossas-ejb3-files-to-place-in-serverlib.txt" />

  <!-- Servers to patch -->
  <property name="servers" value="default;all" />

  <!-- Optional Tasks =================================================================== -->

  <taskdef resource="net/sf/antcontrib/antcontrib.properties">
    <classpath>
      <pathelement location="${installer.home}/lib/ant-contrib.jar" />
    </classpath>
  </taskdef>

  <!-- Targets ========================================================================= -->

  <!--
  
  Initializes the Build
  
  -->
  <target name="init">

    <if>
      <isset property="jboss.home" />
      <then>
        <echo>JBoss Home Directory is: ${jboss.home}</echo>
      </then>
      <else>
        <echo>Ensure Environment Variable "JBOSS_HOME" is set before running.</echo>
        <fail message="Ensure Environment Variable 'JBOSS_HOME' is set before running." />
      </else>
    </if>

    <if>
      <isset property="installer.home" />
      <then>
        <echo>EJB3 Plugin Installer Home Directory is: ${installer.home}</echo>
      </then>
      <else>
        <echo>Ensure Environment Variable "JBOSS_EJB3_PLUGIN_INSTALL_HOME" is set before running.</echo>
        <fail message="Ensure Environment Variable 'JBOSS_EJB3_PLUGIN_INSTALL_HOME' is set before running." />
      </else>
    </if>

  </target>

  <!-- 
  
  Installs the EJB3 Plugin 
  
  -->
  <target name="install" depends="clean">

    <echo>Installing EJB3 Plugin to ${jboss.home}</echo>

    <!-- Copy all binaries to "lib" directory of each server -->
    <foreach list="${servers}" delimiter=";" param="serverName" target="install-libs" inheritall="true" />

  </target>

  <!-- 
  
  Cleans existing EJB3 Binaries from
  the AS Installation   
  
  -->
  <target name="clean" depends="init">

    <echo>Cleaning ${jboss.home} of EJB3 Binaries and Descriptors...</echo>

    <delete verbose="true" includeemptydirs="true">
      <fileset dir="${jboss.home}" includesfile="${file.jbossas.remove.includes}" />
    </delete>

  </target>

  <!-- 
  
  Installs binaries to the "lib" directory of the
  specified "serverName"
  
  -->
  <target name="install-libs">

    <echo>Installing EJB3 Binaries to "lib" of Server "${serverName}"</echo>

    <copy todir="${jboss.home}/server/${serverName}/lib">
      <fileset dir="${installer.lib}" includesfile="${file.jbossas.serverlib.includes}" />
    </copy>

  </target>

</project>